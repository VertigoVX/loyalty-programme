<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Purple Rewards - Loyalty Program</title>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-color: #764ba2;
            --secondary-color: #667eea;
            --surface-color: rgba(255, 255, 255, 0.98);
            --text-primary: #333;
            --text-secondary: #666;
            --text-muted: #999;
            --border-radius-sm: 12px;
            --border-radius-md: 20px;
            --border-radius-lg: 24px;
            --border-radius-xl: 28px;
            --spacing-xs: 8px;
            --spacing-sm: 12px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-2xl: 48px;
            --shadow-sm: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-md: 0 8px 32px rgba(0,0,0,0.08);
            --shadow-lg: 0 16px 48px rgba(0,0,0,0.12);
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
            scroll-behavior: smooth;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.98);
            padding: 16px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #764ba2;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo::before {
            content: "";
            width: 28px;
            height: 28px;
            background-image: url('./assets/star.svg');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            display: inline-block;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .points-display {
            background: linear-gradient(135deg, #764ba2, #667eea);
            color: white;
            padding: 12px 20px;
            border-radius: 24px;
            font-weight: 600;
            font-size: 14px;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(118, 75, 162, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .points-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .points-display:hover::before {
            left: 100%;
        }

        .points-display:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(118, 75, 162, 0.4);
        }

        .journey-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 24px;
            padding: 48px;
            margin: 32px 0;
            box-shadow: 0 20px 60px rgba(0,0,0,0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .journey-container:hover {
            transform: translateY(-4px);
            box-shadow: 0 25px 80px rgba(0,0,0,0.12);
        }

        .journey-title {
            text-align: center;
            font-size: 40px;
            color: #764ba2;
            margin-bottom: 48px;
            font-weight: 800;
            letter-spacing: -1px;
            line-height: 1.2;
        }

        .journey-path {
            position: relative;
            padding: 40px 0;
            margin: 40px 0;
        }

        .path-line {
            position: absolute;
            top: 50%;
            left: 10%;
            right: 10%;
            height: 3px;
            background: #e0e0e0;
            z-index: 1;
        }

        .path-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 1s ease;
            border-radius: 2px;
        }

        .milestones {
            display: flex;
            justify-content: space-between;
            position: relative;
            z-index: 2;
        }

        .milestone {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .milestone:hover {
            transform: translateY(-5px);
        }

        .milestone-icon {
            width: 80px;
            height: 80px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            background: white;
            border: 3px solid #e0e0e0;
            position: relative;
            transition: all 0.3s ease;
        }

        .milestone.completed .milestone-icon {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #764ba2;
            color: white;
            box-shadow: 0 5px 20px rgba(118, 75, 162, 0.3);
        }

        .milestone.current .milestone-icon {
            background: #ffc107;
            border-color: #ffc107;
            animation: pulse 2s infinite;
            box-shadow: 0 5px 20px rgba(255, 193, 7, 0.3);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .milestone-label {
            margin-top: 10px;
            font-weight: 600;
            color: #666;
        }

        .milestone-points {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        .tier-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin: 48px 0;
        }

        .tier-card {
            background: white;
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .tier-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transform: scaleX(0);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tier-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 16px 48px rgba(0,0,0,0.12);
            border-color: rgba(118, 75, 162, 0.2);
        }

        .tier-card:hover::before {
            transform: scaleX(1);
        }

        .tier-card.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(118, 75, 162, 0.3);
        }

        .tier-card.active::before {
            transform: scaleX(1);
            background: rgba(255, 255, 255, 0.3);
        }

        .tier-card:focus {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }

        .tier-card:focus:not(:focus-visible) {
            outline: none;
        }

        .tier-card:focus-visible {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }

        .tier-badge {
            width: 72px;
            height: 72px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, rgba(118, 75, 162, 0.1), rgba(102, 126, 234, 0.1));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .tier-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
            border-radius: 20px;
        }

        .tier-card.active .tier-badge {
            background: rgba(255, 255, 255, 0.2);
        }

        .tier-name {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 12px;
            text-align: center;
            letter-spacing: -0.5px;
        }

        .tier-requirements {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
            text-align: center;
        }

        .tier-card.active .tier-requirements {
            color: rgba(255, 255, 255, 0.9);
        }

        .tier-benefits {
            list-style: none;
            font-size: 14px;
        }

        .tier-benefits li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
        }

        .tier-benefits li::before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #4caf50;
        }

        .tier-card.active .tier-benefits li::before {
            color: #fff;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 40px 0;
        }

        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 28px;
            min-height: 48px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn:focus {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }

        .btn:focus:not(:focus-visible) {
            outline: none;
        }

        .btn:focus-visible {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(118, 75, 162, 0.4);
            background: linear-gradient(135deg, #7c8aed, #8b5fbf);
        }

        .btn-primary:active {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(118, 75, 162, 0.3);
        }

        .btn-secondary {
            background: white;
            color: #764ba2;
            border: 2px solid #764ba2;
        }

        .btn-secondary:hover {
            background: #764ba2;
            color: white;
        }

        .rewards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .reward-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .reward-item:hover {
            transform: translateY(-5px);
        }

        .reward-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .reward-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .reward-desc {
            font-size: 12px;
            color: #666;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        /* Holly Store Modal Specific Styles */
        .modal-content.holly-store-modal {
            max-width: 95vw;
            width: 95%;
            max-height: 90vh;
            padding: 0;
        }

        .holly-store-modal-header {
            position: sticky;
            top: 0;
            background: white;
            border-bottom: 2px solid #f0f0f0;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
            border-radius: 20px 20px 0 0;
        }

        .holly-store-modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #764ba2;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .holly-store-close-btn {
            background: #f0f0f0;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: #666;
        }

        .holly-store-close-btn:hover {
            background: #e0e0e0;
            transform: scale(1.1);
            color: #333;
        }

        .holly-store-modal-body {
            padding: 20px;
            max-height: calc(90vh - 80px);
            overflow-y: auto;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #764ba2;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .progress-bar {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            height: 48px;
            border-radius: 24px;
            overflow: hidden;
            margin: 28px 0;
            box-shadow: 
                inset 0 2px 8px rgba(0,0,0,0.06),
                0 6px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(255, 255, 255, 0.5);
            position: relative;
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255,255,255,0.3), transparent);
            border-radius: 25px 25px 0 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%);
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.3);
            position: relative;
        }

        .progress-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: progressShimmer 2s infinite;
        }

        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .progress-info .current-points {
            font-weight: bold;
            color: #764ba2;
            background: rgba(118, 75, 162, 0.1);
            padding: 8px 12px;
            border-radius: 20px;
            border: 2px solid rgba(118, 75, 162, 0.2);
        }

        .progress-info .progress-label {
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }

        .progress-info .target-points {
            font-weight: bold;
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            padding: 8px 12px;
            border-radius: 20px;
            border: 2px solid rgba(102, 126, 234, 0.2);
        }

        .progress-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            font-size: 14px;
        }

        .progress-details .points-needed {
            color: #666;
            font-weight: 500;
            background: rgba(0,0,0,0.05);
            padding: 6px 12px;
            border-radius: 15px;
        }

        .progress-details .next-tier-name {
            color: #667eea;
            font-weight: bold;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            padding: 6px 12px;
            border-radius: 15px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        /* Authentication Page Styles */
        .auth-container {
            display: none;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-container.active {
            display: flex;
        }

        .auth-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            text-align: center;
            animation: slideIn 0.5s ease;
        }

        .auth-logo {
            width: 48px;
            height: 48px;
            margin: 0 auto 10px;
            background-image: url('./assets/star.svg');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .auth-title {
            font-size: 28px;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 10px;
        }

        .auth-subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .auth-tabs {
            display: flex;
            background: #f5f5f5;
            border-radius: 25px;
            padding: 4px;
            margin-bottom: 30px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #666;
        }

        .auth-tab.active {
            background: white;
            color: #764ba2;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .form-input:focus {
            outline: none;
            border-color: #764ba2;
        }

        .form-input.error {
            border-color: #f44336;
        }

        .error-message {
            color: #f44336;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .auth-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin-top: 10px;
        }

        .auth-button:hover {
            transform: translateY(-2px);
        }

        .auth-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .auth-divider {
            margin: 20px 0;
            position: relative;
            text-align: center;
            color: #666;
        }

        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e0e0e0;
        }

        .auth-divider span {
            background: white;
            padding: 0 15px;
        }

        .social-login {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .social-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 20px;
        }

        .social-btn:hover {
            border-color: #764ba2;
            transform: translateY(-2px);
        }

        .forgot-password {
            color: #764ba2;
            text-decoration: none;
            font-size: 14px;
            margin-top: 15px;
            display: inline-block;
        }

        .forgot-password:hover {
            text-decoration: underline;
        }

        .main-content {
            display: block;
        }

        .main-content.hidden {
            display: none;
        }

        @media (max-width: 768px) {
            body {
                font-size: 14px;
            }

            .container {
                padding: 16px;
            }

            /* Header improvements */
            .header-content {
                padding: 0 20px;
                flex-wrap: wrap;
                gap: 12px;
            }

            .logo {
                font-size: 22px;
            }

            .points-display {
                padding: 10px 16px;
                font-size: 13px;
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .user-info {
                gap: 10px;
                flex-wrap: wrap;
            }


            .btn {
                padding: 8px 16px;
                font-size: 14px;
            }

            /* Journey container improvements */
            .journey-container {
                padding: 20px 15px;
                margin: 15px 0;
            }

            .journey-title {
                font-size: 24px;
                margin-bottom: 25px;
            }
            
            .milestones {
                flex-direction: column;
                gap: 20px;
                align-items: center;
                position: relative;
            }

            .milestones::before {
                content: '';
                position: absolute;
                top: 60px;
                bottom: 60px;
                left: 50%;
                width: 4px;
                background: #e0e0e0;
                transform: translateX(-50%);
                z-index: 1;
            }

            .milestones::after {
                content: '';
                position: absolute;
                top: 60px;
                left: 50%;
                width: 4px;
                height: 25%;
                background: linear-gradient(180deg, #667eea, #764ba2);
                transform: translateX(-50%);
                z-index: 2;
                border-radius: 2px;
            }

            .milestone {
                width: 100%;
                max-width: 200px;
                flex-direction: row;
                justify-content: flex-start;
                gap: 15px;
                padding: 15px;
                background: rgba(255, 255, 255, 0.9);
                border-radius: 15px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                position: relative;
                z-index: 3;
            }

            .milestone-icon {
                width: 60px;
                height: 60px;
                font-size: 30px;
                flex-shrink: 0;
            }

            .milestone-info {
                text-align: left;
            }

            .milestone-label {
                font-size: 16px;
                margin: 0;
            }

            .milestone-points {
                font-size: 12px;
                margin: 2px 0 0 0;
            }
            
            .path-line {
                display: none;
            }

            /* Progress bar improvements */
            .progress-bar {
                height: 35px;
                margin: 20px 0;
                border-radius: 20px;
            }

            .progress-fill {
                font-size: 14px;
            }

            .progress-info {
                flex-direction: column;
                gap: 10px;
                text-align: center;
                margin-bottom: 20px;
            }

            .progress-info .progress-label {
                font-size: 14px;
                order: -1;
            }

            .progress-details {
                flex-direction: column;
                gap: 8px;
                text-align: center;
                margin-top: 20px;
            }
            
            .tier-details {
                grid-template-columns: 1fr;
                gap: 15px;
                margin: 25px 0;
            }

            .tier-card {
                padding: 20px 15px;
            }

            .tier-name {
                font-size: 18px;
            }

            .tier-requirements {
                font-size: 13px;
            }

            .tier-benefits {
                font-size: 13px;
            }

            /* Action buttons improvements */
            .action-buttons {
                flex-direction: column;
                gap: 10px;
                margin: 25px 0;
            }

            .btn {
                width: 100%;
                padding: 12px 20px;
            }

            /* Rewards grid improvements */
            .rewards-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
                margin: 20px 0;
            }

            .reward-item {
                padding: 15px 10px;
            }

            .reward-icon {
                font-size: 30px;
                margin-bottom: 8px;
            }

            .reward-title {
                font-size: 14px;
                margin-bottom: 3px;
            }

            .reward-desc {
                font-size: 11px;
            }

            /* Modal improvements */
            .modal-content {
                margin: 20px;
                padding: 25px 20px;
                max-width: none;
                width: calc(100% - 40px);
            }

            .modal-content.holly-store-modal {
                margin: 10px;
                width: calc(100% - 20px);
                max-width: none;
                max-height: calc(100vh - 20px);
                padding: 0;
            }

            .holly-store-modal-header {
                padding: 15px;
                border-radius: 20px 20px 0 0;
            }

            .holly-store-modal-title {
                font-size: 20px;
            }

            .holly-store-close-btn {
                width: 35px;
                height: 35px;
                font-size: 18px;
            }

            .holly-store-modal-body {
                padding: 15px;
                max-height: calc(100vh - 90px);
            }

            /* Holly Store Items Mobile Responsive */
            .holly-store-modal-body [style*="display: grid"] {
                gap: 15px !important;
            }

            .holly-store-modal-body [style*="padding: 20px"] {
                padding: 15px !important;
            }

            .holly-store-modal-body [style*="font-size: 32px"] {
                font-size: 28px !important;
            }

            .modal-title {
                font-size: 20px;
            }

            /* Auth page improvements */
            .auth-container {
                padding: 15px;
            }

            .auth-card {
                padding: 25px 20px;
                max-width: none;
                width: 100%;
            }

            .auth-title {
                font-size: 24px;
            }

            .auth-subtitle {
                font-size: 14px;
                margin-bottom: 25px;
            }

            .auth-tabs {
                margin-bottom: 25px;
            }

            .auth-tab {
                padding: 10px 15px;
                font-size: 14px;
            }

            .form-input {
                padding: 12px;
                font-size: 16px; /* Prevents zoom on iOS */
            }

            .auth-button {
                padding: 12px;
                font-size: 16px;
            }

            .social-login {
                gap: 8px;
            }

            .social-btn {
                padding: 10px;
                font-size: 18px;
            }

            /* Notification improvements */
            .notification {
                right: 15px;
                left: 15px;
                top: 15px;
                width: auto;
                font-size: 14px;
                padding: 12px 20px;
            }
        }

        /* Spinner Overlay Styles */
        .spinner-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .spinner-overlay.active {
            display: flex;
        }

        .spinner-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            position: relative;
            animation: slideIn 0.3s ease;
        }

        .spinner-title {
            font-size: 24px;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 20px;
        }

        .wheel-container {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 0 auto 30px;
        }

        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            border: 8px solid #764ba2;
            transition: transform 3s cubic-bezier(0.23, 1, 0.32, 1);
            background: conic-gradient(
                #ff6b6b 0deg 45deg,
                #4ecdc4 45deg 90deg,
                #45b7d1 90deg 135deg,
                #96ceb4 135deg 180deg,
                #feca57 180deg 225deg,
                #ff9ff3 225deg 270deg,
                #54a0ff 270deg 315deg,
                #5f27cd 315deg 360deg
            );
        }

        .wheel-text {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .wheel-segment {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 25px;
        }

        .wheel-segment span {
            font-weight: bold;
            font-size: 11px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            text-align: center;
            line-height: 1.1;
            transform: rotate(-22.5deg);
        }

        .wheel-segment:nth-child(1) {
            transform: rotate(0deg);
        }

        .wheel-segment:nth-child(2) {
            transform: rotate(45deg);
        }

        .wheel-segment:nth-child(3) {
            transform: rotate(90deg);
        }

        .wheel-segment:nth-child(4) {
            transform: rotate(135deg);
        }

        .wheel-segment:nth-child(5) {
            transform: rotate(180deg);
        }

        .wheel-segment:nth-child(6) {
            transform: rotate(225deg);
        }

        .wheel-segment:nth-child(7) {
            transform: rotate(270deg);
        }

        .wheel-segment:nth-child(8) {
            transform: rotate(315deg);
        }

        .wheel-pointer {
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 25px solid #764ba2;
            z-index: 10;
        }

        .spin-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .spin-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(118, 75, 162, 0.3);
        }

        .spin-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .spinner-result {
            display: none;
            background: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            color: #2e7d32;
        }

        .spinner-result.show {
            display: block;
            animation: bounceIn 0.5s ease;
        }

        .result-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .result-text {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .result-description {
            font-size: 14px;
            opacity: 0.8;
        }

        .close-spinner {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        @media (max-width: 480px) {
            .journey-title {
                font-size: 20px;
            }

            .milestones::before {
                top: 50px;
                bottom: 50px;
            }

            .milestones::after {
                top: 50px;
                height: 30%;
            }

            .milestone {
                flex-direction: column;
                text-align: center;
                gap: 10px;
                padding: 12px;
                max-width: 150px;
            }

            .milestone-info {
                text-align: center;
            }

            .milestone-icon {
                width: 50px;
                height: 50px;
                font-size: 24px;
            }

            .rewards-grid {
                grid-template-columns: 1fr;
            }

            .tier-card {
                padding: 15px 12px;
            }

            .auth-card {
                padding: 20px 15px;
            }

            .header-content {
                justify-content: center;
                text-align: center;
            }

            .user-info {
                justify-content: center;
                width: 100%;
                margin-top: 10px;
            }

            .spinner-container {
                padding: 20px;
                margin: 20px;
            }

            .wheel-container {
                width: 240px;
                height: 240px;
            }

            .spinner-title {
                font-size: 20px;
            }
        }

        /* Horse Racing Tournament Styles */
        .horse-racing-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .horse-racing-overlay.active {
            display: flex;
        }

        .horse-racing-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideIn 0.3s ease;
        }

        .horse-racing-title {
            font-size: 24px;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 20px;
            text-align: center;
        }

        .race-info {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            text-align: center;
        }

        .race-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .race-time {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .race-countdown {
            font-size: 14px;
            opacity: 0.9;
        }

        .horses-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 25px;
        }

        .horse-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .horse-card:hover {
            border-color: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.2);
        }

        .horse-card.selected {
            border-color: #764ba2;
            background: rgba(118, 75, 162, 0.1);
        }

        .horse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .horse-name {
            font-weight: bold;
            font-size: 16px;
            color: #333;
        }

        .horse-odds {
            background: #4caf50;
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .horse-stats {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .win-chance {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chance-bar {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .chance-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.3s ease;
        }

        .chance-percent {
            font-weight: bold;
            color: #4caf50;
            min-width: 35px;
        }

        .bet-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .bet-amount {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .bet-amount label {
            font-weight: bold;
            color: #333;
        }

        .bet-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        .bet-input:focus {
            outline: none;
            border-color: #764ba2;
        }

        .bet-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .bet-quick {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #764ba2;
            background: white;
            color: #764ba2;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .bet-quick:hover {
            background: #764ba2;
            color: white;
        }

        .potential-win {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .potential-win-text {
            font-size: 14px;
            color: #2e7d32;
            margin-bottom: 5px;
        }

        .potential-win-amount {
            font-size: 20px;
            font-weight: bold;
            color: #4caf50;
        }

        .place-bet-button {
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .place-bet-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(118, 75, 162, 0.3);
        }

        .place-bet-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .close-horse-racing {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        @media (max-width: 480px) {
            .horse-racing-container {
                padding: 20px;
                margin: 20px;
            }

            .horse-racing-title {
                font-size: 20px;
            }

            .bet-buttons {
                flex-wrap: wrap;
            }

            .bet-quick {
                min-width: calc(50% - 5px);
            }
        }

        /* Slots Tournament Styles */
        .slots-tournament-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .slots-tournament-overlay.active {
            display: flex;
        }

        .slots-tournament-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideIn 0.3s ease;
        }

        .slots-tournament-title {
            font-size: 28px;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .tournament-info {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            text-align: center;
        }

        .tournament-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .tournament-target {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            color: #ffc107;
        }

        .tournament-prize {
            font-size: 16px;
            opacity: 0.9;
        }

        .tournament-status {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 14px;
        }

        .slots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .slot-machine {
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
        }

        .slot-machine:hover {
            border-color: #764ba2;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(118, 75, 162, 0.2);
        }

        .slot-machine.selected {
            border-color: #764ba2;
            background: linear-gradient(145deg, rgba(118, 75, 162, 0.1), rgba(102, 126, 234, 0.1));
            box-shadow: 0 5px 20px rgba(118, 75, 162, 0.3);
        }

        .slot-machine.playing {
            border-color: #ffc107;
            background: linear-gradient(145deg, rgba(255, 193, 7, 0.1), rgba(255, 152, 0, 0.1));
            animation: pulse 2s infinite;
        }

        .slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .slot-name {
            font-weight: bold;
            font-size: 16px;
            color: #333;
        }

        .slot-icon {
            font-size: 24px;
        }

        .slot-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .stat-item {
            text-align: center;
            padding: 8px;
            background: rgba(118, 75, 162, 0.1);
            border-radius: 8px;
        }

        .stat-value {
            font-weight: bold;
            color: #764ba2;
            display: block;
        }

        .stat-label {
            color: #666;
            font-size: 12px;
        }

        .slot-progress {
            margin-bottom: 15px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .progress-bar-slot {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill-slot {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .leaderboard {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .leaderboard-title {
            font-size: 18px;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 15px;
            text-align: center;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .leaderboard-item.current-user {
            background: linear-gradient(135deg, rgba(118, 75, 162, 0.1), rgba(102, 126, 234, 0.1));
            border: 2px solid #764ba2;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-rank {
            background: #764ba2;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .player-rank.gold {
            background: #ffd700;
            color: #333;
        }

        .player-rank.silver {
            background: #c0c0c0;
            color: #333;
        }

        .player-rank.bronze {
            background: #cd7f32;
            color: white;
        }

        .player-name {
            font-weight: 600;
            color: #333;
        }

        .player-points {
            font-weight: bold;
            color: #764ba2;
        }

        .tournament-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .join-tournament-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .join-tournament-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(118, 75, 162, 0.3);
        }

        .join-tournament-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .leave-tournament-btn {
            background: #f44336;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .leave-tournament-btn:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }

        .close-slots-tournament {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .spin-controls {
            display: none;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .spin-controls.active {
            display: block;
        }

        .spin-controls-title {
            font-size: 16px;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 15px;
            text-align: center;
        }

        .spin-amount {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .spin-amount label {
            font-weight: bold;
            color: #333;
            min-width: 80px;
        }

        .spin-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        .spin-input:focus {
            outline: none;
            border-color: #764ba2;
        }

        .spin-quick-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .spin-quick {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #764ba2;
            background: white;
            color: #764ba2;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .spin-quick:hover {
            background: #764ba2;
            color: white;
        }

        .spin-button {
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .spin-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(118, 75, 162, 0.3);
        }

        .spin-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        @media (max-width: 768px) {
            .slots-tournament-container {
                padding: 20px;
                margin: 20px;
            }

            .slots-tournament-title {
                font-size: 24px;
            }

            .slots-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .tournament-actions {
                flex-direction: column;
            }

            .spin-quick-buttons {
                flex-wrap: wrap;
            }

            .spin-quick {
                min-width: calc(50% - 5px);
            }
        }

        /* Prize Drop Overlay Styles */
        .prize-drop-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 4000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s ease;
        }

        .prize-drop-overlay.active {
            display: flex;
        }

        .prize-drop-container {
            background: linear-gradient(145deg, #fff, #f8f9fa);
            border-radius: 25px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
            animation: prizeDropIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 3px solid #ffd700;
        }

        @keyframes prizeDropIn {
            0% {
                transform: translateY(-100vh) rotate(180deg) scale(0.5);
                opacity: 0;
            }
            50% {
                transform: translateY(20px) rotate(90deg) scale(1.1);
                opacity: 0.8;
            }
            100% {
                transform: translateY(0) rotate(0deg) scale(1);
                opacity: 1;
            }
        }

        .prize-drop-header {
            margin-bottom: 30px;
        }

        .prize-drop-title {
            font-size: 32px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3), 0 0 10px #ffd700;
            }
            to {
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3), 0 0 20px #ffd700, 0 0 30px #ffd700;
            }
        }

        .prize-drop-subtitle {
            font-size: 18px;
            color: #764ba2;
            font-weight: 600;
        }

        .prize-item {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .prize-item::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
            100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
        }

        .prize-icon {
            font-size: 80px;
            margin-bottom: 15px;
            display: block;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-20px);
            }
            60% {
                transform: translateY(-10px);
            }
        }

        .prize-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .prize-description {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .prize-value {
            font-size: 20px;
            font-weight: bold;
            color: #ffd700;
            background: rgba(255, 215, 0, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
        }

        .prize-actions {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .claim-prize-btn {
            background: linear-gradient(135deg, #ffd700, #ffb300);
            color: #333;
            border: none;
            border-radius: 25px;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .claim-prize-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }

        .continue-betting-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .continue-betting-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(118, 75, 162, 0.3);
        }

        .close-prize-drop {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease;
        }

        .close-prize-drop:hover {
            color: #333;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ffd700;
            animation: confetti-fall 3s linear infinite;
        }

        .confetti:nth-child(odd) {
            background: #ff6b6b;
            animation-delay: -0.5s;
        }

        .confetti:nth-child(even) {
            background: #4ecdc4;
            animation-delay: -1s;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .selected-games-info {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .selected-games-title {
            font-size: 18px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }

        .selected-games-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .selected-game {
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
            color: #333;
        }

        @media (max-width: 768px) {
            .prize-drop-container {
                padding: 30px 20px;
                margin: 20px;
            }

            .prize-drop-title {
                font-size: 28px;
            }

            .prize-icon {
                font-size: 60px;
            }

            .prize-actions {
                flex-direction: column;
            }

            .selected-games-list {
                grid-template-columns: 1fr;
            }
        }

        /* Lucky Pick Overlay Styles */
        .lucky-pick-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 3500;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .lucky-pick-overlay.active {
            display: flex;
        }

        .lucky-pick-container {
            background: linear-gradient(145deg, #fff, #f8f9fa);
            border-radius: 20px;
            padding: 30px;
            max-width: 550px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            animation: slideIn 0.4s ease;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
            border: 2px solid #4caf50;
        }

        .lucky-pick-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .lucky-pick-title {
            font-size: 28px;
            font-weight: bold;
            color: #4caf50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .lucky-pick-subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 15px;
        }

        .lucky-pick-badge {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            display: inline-block;
        }

        .bet-packages {
            display: grid;
            gap: 20px;
            margin-bottom: 25px;
        }

        .bet-package {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: white;
        }

        .bet-package:hover {
            border-color: #4caf50;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.2);
        }

        .bet-package.selected {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.05);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.3);
        }

        .package-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .package-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .package-price {
            background: #4caf50;
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 16px;
        }

        .package-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .package-bets {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }

        .package-bets-title {
            font-size: 14px;
            font-weight: bold;
            color: #4caf50;
            margin-bottom: 10px;
        }

        .bet-list {
            display: grid;
            gap: 8px;
        }

        .bet-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            font-size: 13px;
            border-left: 3px solid #4caf50;
        }

        .bet-game {
            font-weight: 600;
            color: #333;
        }

        .bet-details {
            color: #666;
            font-size: 12px;
        }

        .bet-amount {
            font-weight: bold;
            color: #4caf50;
        }

        .package-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-weight: bold;
            color: #4caf50;
            font-size: 16px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        .lucky-pick-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .activate-bets-btn {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .activate-bets-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        .activate-bets-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .regenerate-btn {
            background: white;
            color: #4caf50;
            border: 2px solid #4caf50;
            border-radius: 25px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .regenerate-btn:hover {
            background: #4caf50;
            color: white;
            transform: translateY(-2px);
        }

        .close-lucky-pick {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease;
        }

        .close-lucky-pick:hover {
            color: #333;
        }

        .novice-info {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid #4caf50;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .novice-info-title {
            font-weight: bold;
            color: #4caf50;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .novice-info-text {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }

        .confidence-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .confidence-bar {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.3s ease;
        }

        .confidence-text {
            font-size: 12px;
            font-weight: bold;
            color: #4caf50;
        }

        @media (max-width: 768px) {
            .lucky-pick-container {
                padding: 25px 20px;
                margin: 20px;
            }

            .lucky-pick-title {
                font-size: 24px;
            }

            .bet-packages {
                gap: 15px;
            }

            .lucky-pick-actions {
                flex-direction: column;
            }

            .package-stats {
                flex-direction: column;
                gap: 10px;
            }

            .stat-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
        }

        /* Holly Store Styles */
        .holly-store {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 40px 0 0 0;
            padding: 40px 0;
            border-radius: 20px 20px 0 0;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .holly-store::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="stars" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23stars)"/></svg>');
            opacity: 0.3;
        }

        .holly-store-content {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .holly-store-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .holly-store-title {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .holly-store-subtitle {
            font-size: 18px;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .holly-store-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            display: inline-block;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .store-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .store-category {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .store-category:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .category-icon {
            font-size: 32px;
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .category-info h3 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .category-info p {
            font-size: 14px;
            opacity: 0.8;
        }

        .store-items {
            display: grid;
            gap: 15px;
        }

        .store-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .store-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .item-description {
            font-size: 13px;
            opacity: 0.8;
            margin-bottom: 8px;
        }

        .item-tier-req {
            font-size: 11px;
            background: rgba(255, 255, 255, 0.2);
            padding: 3px 8px;
            border-radius: 10px;
            display: inline-block;
        }

        .item-price {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .price-points {
            font-size: 18px;
            font-weight: bold;
            color: #ffd700;
        }

        .redeem-btn {
            background: linear-gradient(135deg, #ffd700, #ffb300);
            color: #333;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .redeem-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .redeem-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .tier-locked {
            opacity: 0.6;
            position: relative;
        }

        .tier-locked::after {
            content: '🔒';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 16px;
        }

        .points-insufficient {
            opacity: 0.7;
        }

        .store-footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .store-footer-text {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 15px;
        }

        .tier-progress-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            display: inline-block;
        }

        @media (max-width: 768px) {
            .holly-store {
                margin: 30px 0 0 0;
                padding: 30px 0;
            }

            .holly-store-title {
                font-size: 28px;
            }

            .store-categories {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .store-category {
                padding: 20px;
            }

            .category-header {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }

            .category-icon {
                font-size: 28px;
                width: 50px;
                height: 50px;
            }

            .store-item {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .item-price {
                flex-direction: row;
                justify-content: center;
            }
        }

        /* FAQ Section Styles */
        .faq-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            margin: 40px 0 0 0;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .faq-toggle-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .faq-toggle-header:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
        }

        .faq-toggle-title {
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .faq-toggle-arrow {
            font-size: 24px;
            transition: transform 0.3s ease;
        }

        .faq-section.collapsed .faq-toggle-arrow {
            transform: rotate(-90deg);
        }

        .faq-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .faq-section:not(.collapsed) .faq-content {
            max-height: 2000px;
            padding: 40px;
        }

        .faq-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .faq-title {
            font-size: 32px;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .faq-subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 20px;
        }

        .faq-search {
            max-width: 400px;
            margin: 0 auto;
            position: relative;
        }

        .faq-search-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .faq-search-input:focus {
            outline: none;
            border-color: #764ba2;
        }

        .faq-search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 18px;
        }

        .faq-categories {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .faq-category-btn {
            background: white;
            border: 2px solid #764ba2;
            color: #764ba2;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .faq-category-btn:hover,
        .faq-category-btn.active {
            background: #764ba2;
            color: white;
            transform: translateY(-2px);
        }

        .faq-list {
            display: grid;
            gap: 15px;
        }

        .faq-item {
            background: white;
            border-radius: 15px;
            border: 2px solid #f0f0f0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .faq-item:hover {
            border-color: #764ba2;
            box-shadow: 0 5px 20px rgba(118, 75, 162, 0.1);
        }

        .faq-item.active {
            border-color: #764ba2;
            box-shadow: 0 5px 20px rgba(118, 75, 162, 0.2);
        }

        .faq-question {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #333;
            transition: all 0.3s ease;
        }

        .faq-question:hover {
            background: rgba(118, 75, 162, 0.05);
        }

        .faq-question-text {
            flex: 1;
            font-size: 16px;
        }

        .faq-toggle {
            font-size: 20px;
            color: #764ba2;
            transition: transform 0.3s ease;
            margin-left: 15px;
        }

        .faq-item.active .faq-toggle {
            transform: rotate(180deg);
        }

        .faq-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            background: rgba(118, 75, 162, 0.02);
        }

        .faq-item.active .faq-answer {
            max-height: 500px;
            padding: 0 20px 20px 20px;
        }

        .faq-answer-content {
            color: #666;
            line-height: 1.6;
            font-size: 15px;
        }

        .faq-answer-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .faq-answer-content li {
            margin: 5px 0;
        }

        .faq-answer-content strong {
            color: #764ba2;
        }

        .faq-highlight {
            background: rgba(255, 193, 7, 0.2);
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 600;
        }

        .faq-no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
            display: none;
        }

        .faq-contact {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-top: 30px;
        }

        .faq-contact h4 {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .faq-contact p {
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .faq-contact-btn {
            background: white;
            color: #764ba2;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .faq-contact-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .faq-section {
                padding: 25px 20px;
                margin: 25px 0;
            }

            .faq-title {
                font-size: 26px;
            }

            .faq-categories {
                gap: 8px;
            }

            .faq-category-btn {
                padding: 6px 12px;
                font-size: 13px;
            }

            .faq-question {
                padding: 15px;
            }

            .faq-question-text {
                font-size: 15px;
            }

            .faq-item.active .faq-answer {
                padding: 0 15px 15px 15px;
            }

            .faq-answer-content {
                font-size: 14px;
            }
        }

        /* Challenges System Styles */
        .challenges-section {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .challenges-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shine 4s infinite;
        }

        .challenges-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            position: relative;
            z-index: 2;
        }

        .challenges-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: bold;
        }

        .streak-counter {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .streak-flame {
            font-size: 20px;
            animation: flicker 2s infinite alternate;
        }

        @keyframes flicker {
            0% { transform: scale(1) rotate(-2deg); }
            100% { transform: scale(1.1) rotate(2deg); }
        }

        .challenges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            position: relative;
            z-index: 2;
        }

        .challenge-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
        }

        .challenge-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .challenge-card.completed {
            background: rgba(76, 175, 80, 0.3);
            border-color: rgba(76, 175, 80, 0.5);
        }

        .challenge-card.completed::after {
            content: '✓';
            position: absolute;
            top: 15px;
            right: 15px;
            background: #4caf50;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .challenge-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .challenge-icon {
            font-size: 28px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .challenge-info h4 {
            margin: 0 0 5px 0;
            font-size: 16px;
            font-weight: bold;
        }

        .challenge-info p {
            margin: 0;
            font-size: 13px;
            opacity: 0.9;
        }

        .challenge-progress {
            margin: 15px 0;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            opacity: 0.9;
        }

        .challenge-reward {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .reward-points {
            background: rgba(255, 215, 0, 0.3);
            color: #ffd700;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            border: 1px solid rgba(255, 215, 0, 0.5);
        }

        .challenge-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .challenge-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .challenge-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .streak-milestones {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .milestone-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .milestones-grid {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .milestone {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            min-width: 80px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .milestone.achieved {
            background: rgba(255, 215, 0, 0.3);
            border-color: #ffd700;
            transform: scale(1.05);
        }

        .milestone.current {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .milestone-day {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .milestone-reward {
            font-size: 11px;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .challenges-section {
                padding: 20px 15px;
                margin: 20px 0;
            }

            .challenges-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .challenges-title {
                font-size: 20px;
            }

            .challenges-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .challenge-card {
                padding: 15px;
            }

            .challenge-icon {
                font-size: 24px;
                width: 40px;
                height: 40px;
            }

            .milestones-grid {
                gap: 10px;
            }

            .milestone {
                min-width: 70px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Page -->
    <div class="auth-container active" id="authContainer">
        <div class="auth-card">
            <div class="auth-logo"></div>
            <h1 class="auth-title">Purple Rewards</h1>
            <p class="auth-subtitle">Join our exclusive loyalty program</p>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')" role="tab" aria-selected="true" aria-controls="loginForm">Sign In</button>
                <button class="auth-tab" onclick="switchAuthTab('signup')" role="tab" aria-selected="false" aria-controls="signupForm">Sign Up</button>
            </div>

            <!-- Login Form -->
            <form class="auth-form active" id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="loginEmail" required>
                    <div class="error-message" id="loginEmailError">Please enter a valid email</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="loginPassword" required>
                    <div class="error-message" id="loginPasswordError">Password is required</div>
                </div>
                
                <button type="submit" class="auth-button">Sign In</button>
                <a href="#" class="forgot-password" onclick="showForgotPassword()">Forgot Password?</a>
            </form>

            <!-- Signup Form -->
            <form class="auth-form" id="signupForm">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" id="signupName" required>
                    <div class="error-message" id="signupNameError">Name is required</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="signupEmail" required>
                    <div class="error-message" id="signupEmailError">Please enter a valid email</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="signupPassword" required>
                    <div class="error-message" id="signupPasswordError">Password must be at least 6 characters</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" class="form-input" id="signupConfirmPassword" required>
                    <div class="error-message" id="signupConfirmPasswordError">Passwords don't match</div>
                </div>
                
                <button type="submit" class="auth-button">Create Account</button>
            </form>

            <div class="auth-divider">
                <span>or continue with</span>
            </div>

            <div class="social-login">
                <button class="social-btn" onclick="socialLogin('google')" title="Continue with Google" aria-label="Sign in with Google">🔍</button>
                <button class="social-btn" onclick="socialLogin('facebook')" title="Continue with Facebook" aria-label="Sign in with Facebook">📘</button>
                <button class="social-btn" onclick="socialLogin('apple')" title="Continue with Apple">🍎</button>
            </div>
        </div>
    </div>

    <!-- Main Content (Initially Hidden) -->
    <div class="main-content hidden" id="mainContent">
        <header>
            <div class="header-content">
                <div class="logo">Purple Rewards</div>
                <div class="user-info">
                    <div class="points-display" id="pointsDisplay">650 Points</div>
                    <button class="btn btn-secondary" onclick="showProfile()">Profile</button>
                    <button class="btn btn-secondary" onclick="logout()" style="margin-left: 10px;">Logout</button>
                </div>
            </div>
        </header>

        <div class="container">
        <div class="journey-container">
            <h1 class="journey-title">Your Purple Rewards Journey</h1>
            
            <div class="journey-path">
                <div class="path-line">
                    <div class="path-progress" id="pathProgress" style="width: 25%"></div>
                </div>
                <div class="milestones">
                    <div class="milestone completed" onclick="showTierDetails(1)">
                        <div class="milestone-icon">⭐</div>
                        <div class="milestone-info">
                            <div class="milestone-label">Rookie</div>
                            <div class="milestone-points">0 pts</div>
                        </div>
                    </div>
                    <div class="milestone current" onclick="showTierDetails(2)">
                        <div class="milestone-icon">🎯</div>
                        <div class="milestone-info">
                            <div class="milestone-label">Power Player</div>
                            <div class="milestone-points">1,000 pts</div>
                        </div>
                    </div>
                    <div class="milestone" onclick="showTierDetails(3)">
                        <div class="milestone-icon">🎰</div>
                        <div class="milestone-info">
                            <div class="milestone-label">Spin Master</div>
                            <div class="milestone-points">5,000 pts</div>
                        </div>
                    </div>
                    <div class="milestone" onclick="showTierDetails(4)">
                        <div class="milestone-icon">👑</div>
                        <div class="milestone-info">
                            <div class="milestone-label">High Roller</div>
                            <div class="milestone-points">10,000 pts</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="progress-info">
                <div class="current-points">
                    <span id="currentPointsDisplay">650 Points</span>
                </div>
                <div class="progress-label">
                    Progress to Next Tier
                </div>
                <div class="target-points">
                    <span id="targetPointsDisplay">1,000 Points</span>
                </div>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 65%">
                    65% to Power Player
                </div>
            </div>
            
            <div class="progress-details">
                <span class="points-needed" id="pointsNeeded">350 points to go</span>
                <span class="next-tier-name" id="nextTierName">🎯 Power Player</span>
            </div>

            <div class="tier-details">
                <div class="tier-card active">
                    <div class="tier-badge">⭐</div>
                    <div class="tier-name">Current Tier: Rookie</div>
                    <div class="tier-requirements">Entry Level</div>
                    <ul class="tier-benefits">
                        <li>Daily free spin wheel</li>
                        <li>2% deposit bonus</li>
                        <li>5 free spins on signup</li>
                        <li>Access to tournaments</li>
                    </ul>
                </div>
                
                <div class="tier-card">
                    <div class="tier-badge">🎯</div>
                    <div class="tier-name">Next: Power Player</div>
                    <div class="tier-requirements">350 points to unlock</div>
                    <ul class="tier-benefits">
                        <li>5% weekend deposit bonus</li>
                        <li>2% cashback on losses</li>
                        <li>Birthday bonus</li>
                        <li>Priority support</li>
                    </ul>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="earnPoints()">Earn More Points</button>
                <button class="btn btn-secondary" onclick="viewRewards()">View Rewards</button>
            </div>

            <!-- Daily Challenges Section -->
            <div class="challenges-section">
                <div class="challenges-header">
                    <div class="challenges-title">
                        🎯 Daily Challenges
                    </div>
                    <div class="streak-counter">
                        <span class="streak-flame">🔥</span>
                        <span id="streakCount">0</span> day streak
                    </div>
                </div>

                <div class="challenges-grid" id="challengesGrid">
                    <!-- Challenges will be populated by JavaScript -->
                </div>

                <div class="streak-milestones">
                    <div class="milestone-title">🏆 Streak Milestones</div>
                    <div class="milestones-grid" id="milestonesGrid">
                        <!-- Milestones will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Holly Store Link -->
            <div style="text-align: center; margin: 40px 0; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; color: white;">
                <div style="font-size: 32px; margin-bottom: 15px;">🛍️</div>
                <h3 style="margin-bottom: 10px;">Holly Store</h3>
                <p style="margin-bottom: 20px; opacity: 0.9;">Redeem your points for exclusive rewards and discounts</p>
                <div style="margin-bottom: 20px;">
                    <span style="background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; font-size: 14px;">
                        Current Points: <strong><span id="hollyStorePoints">650</span></strong>
                    </span>
                </div>
                <button onclick="openHollyStore()" style="background: white; color: #764ba2; border: none; padding: 15px 30px; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    Visit Holly Store →
                </button>
            </div>

            <!-- FAQ Section -->
            <div class="faq-section collapsed" id="faqSection">
                <div class="faq-toggle-header" onclick="toggleFAQSection()">
                    <div class="faq-toggle-title">
                        ❓ Frequently Asked Questions
                    </div>
                    <div class="faq-toggle-arrow">▼</div>
                </div>
                
                <div class="faq-content">
                    <div class="faq-header">
                        <div class="faq-subtitle">
                            Find answers to common questions about Purple Rewards
                        </div>
                        <div class="faq-search">
                            <input type="text" class="faq-search-input" id="faqSearchInput" placeholder="Search for answers...">
                            <span class="faq-search-icon">🔍</span>
                        </div>
                    </div>

                    <div class="faq-categories">
                        <button class="faq-category-btn active" onclick="filterFAQ('all')">All</button>
                        <button class="faq-category-btn" onclick="filterFAQ('points')">Points & Tiers</button>
                        <button class="faq-category-btn" onclick="filterFAQ('rewards')">Rewards</button>
                        <button class="faq-category-btn" onclick="filterFAQ('tournaments')">Tournaments</button>
                        <button class="faq-category-btn" onclick="filterFAQ('store')">Holly Store</button>
                        <button class="faq-category-btn" onclick="filterFAQ('account')">Account</button>
                    </div>

                    <div class="faq-list" id="faqList">
                        <!-- FAQ items will be populated by JavaScript -->
                    </div>

                    <div class="faq-no-results" id="faqNoResults">
                        No questions found matching your search. Try different keywords or browse by category.
                    </div>

                    <div class="faq-contact">
                        <h4>Still need help?</h4>
                        <p>Can't find what you're looking for? Our support team is here to help!</p>
                        <button class="faq-contact-btn" onclick="contactSupport()">Contact Support</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div> <!-- End Main Content -->

    <!-- Spinner Overlay -->
    <div class="spinner-overlay" id="spinnerOverlay">
        <div class="spinner-container">
            <button class="close-spinner" onclick="closeSpinner()">&times;</button>
            <h2 class="spinner-title">🎁 Daily Free Spin!</h2>
            
            <div class="wheel-container">
                <div class="wheel-pointer"></div>
                <div class="wheel" id="wheel">
                    <div class="wheel-text">
                        <div class="wheel-segment"><span>50<br>Points</span></div>
                        <div class="wheel-segment"><span>Free<br>Spin</span></div>
                        <div class="wheel-segment"><span>100<br>Points</span></div>
                        <div class="wheel-segment"><span>Bonus<br>2x</span></div>
                        <div class="wheel-segment"><span>25<br>Points</span></div>
                        <div class="wheel-segment"><span>Cash<br>back</span></div>
                        <div class="wheel-segment"><span>200<br>Points</span></div>
                        <div class="wheel-segment"><span>Jack<br>pot!</span></div>
                    </div>
                </div>
            </div>
            
            <button class="spin-button" id="spinButton" onclick="spinWheel()">
                🎯 SPIN THE WHEEL!
            </button>
            
            <div class="spinner-result" id="spinnerResult">
                <div class="result-icon" id="resultIcon"></div>
                <div class="result-text" id="resultText"></div>
                <div class="result-description" id="resultDescription"></div>
            </div>
        </div>
    </div>

    <!-- Horse Racing Tournament Overlay -->
    <div class="horse-racing-overlay" id="horseRacingOverlay">
        <div class="horse-racing-container">
            <button class="close-horse-racing" onclick="closeHorseRacing()">&times;</button>
            <h2 class="horse-racing-title">🏇 Horse Racing Tournament</h2>
            
            <div class="race-info">
                <div class="race-title">Purple Derby - Race #247</div>
                <div class="race-time">Next Race: <span id="raceTime">3:45 PM</span></div>
                <div class="race-countdown">Starting in: <span id="countdown">2m 15s</span></div>
            </div>

            <div class="horses-grid" id="horsesGrid">
                <!-- Horses will be populated by JavaScript -->
            </div>

            <div class="bet-section" id="betSection" style="display: none;">
                <div class="bet-amount">
                    <label>Bet Amount:</label>
                    <input type="number" class="bet-input" id="betInput" placeholder="Enter points" min="10" max="500">
                </div>
                
                <div class="bet-buttons">
                    <button class="bet-quick" onclick="setBetAmount(25)">25</button>
                    <button class="bet-quick" onclick="setBetAmount(50)">50</button>
                    <button class="bet-quick" onclick="setBetAmount(100)">100</button>
                    <button class="bet-quick" onclick="setBetAmount(200)">200</button>
                </div>

                <div class="potential-win" id="potentialWin" style="display: none;">
                    <div class="potential-win-text">Potential Winnings:</div>
                    <div class="potential-win-amount" id="potentialWinAmount">0 Points</div>
                </div>

                <button class="place-bet-button" id="placeBetButton" onclick="placeBet()" disabled>
                    🎯 Place Bet
                </button>
            </div>
        </div>
    </div>

    <!-- Slots Tournament Overlay -->
    <div class="slots-tournament-overlay" id="slotsTournamentOverlay">
        <div class="slots-tournament-container">
            <button class="close-slots-tournament" onclick="closeSlotsTournament()">&times;</button>
            <h2 class="slots-tournament-title">🎰 Slots Tournament</h2>
            
            <div class="tournament-info">
                <div class="tournament-title">Race to 10,000 Points!</div>
                <div class="tournament-target">🎯 Target: 10,000 Points</div>
                <div class="tournament-prize">🏆 Winner gets 2,500 bonus points!</div>
                <div class="tournament-status" id="tournamentStatus">
                    <span id="participantCount">12</span> players competing • <span id="timeRemaining">2h 45m remaining</span>
                </div>
            </div>

            <div class="leaderboard" id="leaderboard">
                <div class="leaderboard-title">🏆 Current Leaderboard</div>
                <div id="leaderboardList">
                    <!-- Leaderboard items will be populated by JavaScript -->
                </div>
            </div>

            <div class="slots-grid" id="slotsGrid">
                <!-- Slot machines will be populated by JavaScript -->
            </div>

            <div class="spin-controls" id="spinControls">
                <div class="spin-controls-title">🎰 Spin Controls</div>
                
                <div class="spin-amount">
                    <label>Bet Amount:</label>
                    <input type="number" class="spin-input" id="spinInput" placeholder="Enter points" min="5" max="100">
                </div>
                
                <div class="spin-quick-buttons">
                    <button class="spin-quick" onclick="setSpinAmount(5)">5</button>
                    <button class="spin-quick" onclick="setSpinAmount(10)">10</button>
                    <button class="spin-quick" onclick="setSpinAmount(25)">25</button>
                    <button class="spin-quick" onclick="setSpinAmount(50)">50</button>
                </div>

                <button class="spin-button" id="spinSlotButton" onclick="spinSlotMachine()" disabled>
                    🎰 SPIN TO WIN!
                </button>
            </div>

            <div class="tournament-actions">
                <button class="join-tournament-btn" id="joinTournamentBtn" onclick="joinSlotsTournament()">
                    🎯 Join Tournament
                </button>
                <button class="leave-tournament-btn" id="leaveTournamentBtn" onclick="leaveSlotsTournament()" style="display: none;">
                    🚪 Leave Tournament
                </button>
            </div>
        </div>
    </div>

    <!-- Prize Drop Overlay -->
    <div class="prize-drop-overlay" id="prizeDropOverlay">
        <div class="prize-drop-container">
            <button class="close-prize-drop" onclick="closePrizeDrop()">&times;</button>
            
            <div class="prize-drop-header">
                <div class="prize-drop-title">🎉 PRIZE DROP! 🎉</div>
                <div class="prize-drop-subtitle">Congratulations! You won a prize!</div>
            </div>

            <div class="prize-item" id="prizeItem">
                <span class="prize-icon" id="prizeIcon">🎁</span>
                <div class="prize-name" id="prizeName">Mystery Prize</div>
                <div class="prize-description" id="prizeDescription">You've won an amazing prize!</div>
                <div class="prize-value" id="prizeValue">Value: R500</div>
            </div>

            <div class="selected-games-info">
                <div class="selected-games-title">🎯 Prize Drop Games</div>
                <div class="selected-games-list">
                    <div class="selected-game">🔥 Hot Hot Hollywoodbets</div>
                    <div class="selected-game">🍭 Sweet Bonanza</div>
                    <div class="selected-game">🏜️ Sahara Riches</div>
                    <div class="selected-game">🦁 African Fortune</div>
                    <div class="selected-game">🌶️ Chilli Heat</div>
                </div>
            </div>

            <div class="prize-actions">
                <button class="claim-prize-btn" onclick="claimPrize()">
                    🏆 Claim Prize
                </button>
                <button class="continue-betting-btn" onclick="continueBetting()">
                    🎰 Continue Playing
                </button>
            </div>
        </div>
    </div>

    <!-- Lucky Pick Overlay -->
    <div class="lucky-pick-overlay" id="luckyPickOverlay">
        <div class="lucky-pick-container">
            <button class="close-lucky-pick" onclick="closeLuckyPick()">&times;</button>
            
            <div class="lucky-pick-header">
                <div class="lucky-pick-title">🍀 Lucky Pick</div>
                <div class="lucky-pick-subtitle">Pre-selected bets for novice bettors</div>
                <div class="lucky-pick-badge">Algorithm Generated</div>
            </div>

            <div class="novice-info">
                <div class="novice-info-title">
                    <span>ℹ️</span>
                    Perfect for Beginners
                </div>
                <div class="novice-info-text">
                    Our smart algorithm has analyzed current odds and selected the best betting combinations for you. 
                    Simply choose a package and activate your bets - no betting knowledge required!
                </div>
            </div>

            <div class="bet-packages" id="betPackages">
                <!-- Bet packages will be populated by JavaScript -->
            </div>

            <div class="lucky-pick-actions">
                <button class="activate-bets-btn" id="activateBetsBtn" onclick="activateLuckyPick()" disabled>
                    🚀 Activate Bets
                </button>
                <button class="regenerate-btn" onclick="regenerateBets()">
                    🔄 New Picks
                </button>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Tier Details</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <script>
        // User data
        let userData = {
            name: "User",
            points: 650,
            currentTier: 1,
            targetPoints: 1000,
            totalSpent: 1300,
            joinDate: "2024-01-15",
            birthday: "1995-03-15", // Demo birthday
            birthdayBonusClaimed: false,
            isLoggedIn: false,
            doublePointsActive: false,
            doublePointsExpiresAt: null
        };

        // Authentication state
        let authState = {
            isAuthenticated: false,
            currentUser: null
        };

        // Tier data
        const tiers = {
            1: {
                name: "Rookie",
                icon: "⭐",
                minPoints: 0,
                color: "#9c27b0",
                benefits: [
                    "Daily free spin wheel",
                    "2% deposit bonus",
                    "2% Cashback on losses",
                    "5 free spins",
                    "Entry into tournaments"
                ],
                notification: "Welcome to Purple Rewards! You're in!"
            },
            2: {
                name: "Power Player",
                icon: "🎯",
                minPoints: 1000,
                color: "#673ab7",
                benefits: [
                    "5% deposit bonus on weekends",
                    "10% deposit bonus on weekends",
                    "2% Cashback on losses",
                    "Priority support",
                    "Entry into monthly prize draw"
                ],
                notification: "Congrats! You're now Tier 2 (Power Player)"
            },
            3: {
                name: "Spin Master",
                icon: "🎰",
                minPoints: 5000,
                color: "#3f51b5",
                benefits: [
                    "R50 free play or branded merchandise",
                    "10% deposit bonus anytime",
                    "5% cashback on losses",
                    "Exclusive tournaments",
                    "Personalized promotions"
                ],
                notification: "Amazing! You're now Tier 3 (Spin Master)"
            },
            4: {
                name: "High Roller",
                icon: "👑",
                minPoints: 10000,
                color: "#1976d2",
                benefits: [
                    "R100 Free Play or tickets",
                    "Dedicated account manager",
                    "10% cashback on all losses",
                    "VIP event invites",
                    "15% Deposit Bonus anytime"
                ],
                notification: "Welcome to the VIP circle!"
            }
        };

        // Authentication Functions
        function checkAuthState() {
            const savedUser = localStorage.getItem('purpleRewardsUser');
            if (savedUser) {
                const user = JSON.parse(savedUser);
                authState.isAuthenticated = true;
                authState.currentUser = user;
                userData.name = user.name;
                userData.isLoggedIn = true;
                showMainContent();
            } else {
                showAuthPage();
            }
        }

        function switchAuthTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.auth-tab').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick="switchAuthTab('${tab}')"]`).classList.add('active');
            
            // Update forms
            document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
            document.getElementById(tab + 'Form').classList.add('active');
            
            // Clear any error messages
            clearAuthErrors();
        }

        function clearAuthErrors() {
            document.querySelectorAll('.error-message').forEach(msg => msg.classList.remove('show'));
            document.querySelectorAll('.form-input').forEach(input => input.classList.remove('error'));
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function validateForm(formType) {
            let isValid = true;
            clearAuthErrors();

            if (formType === 'login') {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;

                // DEMO MODE: More lenient validation - just check if fields are not empty
                if (!email.trim()) {
                    showFieldError('loginEmail', 'loginEmailError');
                    document.getElementById('loginEmailError').textContent = 'Please enter an email';
                    isValid = false;
                }

                if (!password.trim()) {
                    showFieldError('loginPassword', 'loginPasswordError');
                    document.getElementById('loginPasswordError').textContent = 'Please enter a password';
                    isValid = false;
                }
            } else if (formType === 'signup') {
                const name = document.getElementById('signupName').value;
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const confirmPassword = document.getElementById('signupConfirmPassword').value;

                // DEMO MODE: More lenient validation
                if (!name.trim()) {
                    showFieldError('signupName', 'signupNameError');
                    isValid = false;
                }

                if (!email.trim()) {
                    showFieldError('signupEmail', 'signupEmailError');
                    document.getElementById('signupEmailError').textContent = 'Please enter an email';
                    isValid = false;
                }

                if (!password.trim()) {
                    showFieldError('signupPassword', 'signupPasswordError');
                    document.getElementById('signupPasswordError').textContent = 'Please enter a password';
                    isValid = false;
                }

                if (password.trim() && confirmPassword.trim() && password !== confirmPassword) {
                    showFieldError('signupConfirmPassword', 'signupConfirmPasswordError');
                    isValid = false;
                }
            }

            return isValid;
        }

        function showFieldError(fieldId, errorId) {
            document.getElementById(fieldId).classList.add('error');
            document.getElementById(errorId).classList.add('show');
        }

        function handleLogin(event) {
            event.preventDefault();
            
            if (!validateForm('login')) {
                return;
            }

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            // Simulate login process
            const button = event.target.querySelector('.auth-button');
            button.disabled = true;
            button.textContent = 'Signing In...';

            setTimeout(() => {
                // DEMO MODE: Accept any credentials and create/login user
                const existingUsers = JSON.parse(localStorage.getItem('purpleRewardsUsers') || '[]');
                let user = existingUsers.find(u => u.email === email);

                if (!user) {
                    // Create a demo user if doesn't exist
                    const userName = email.split('@')[0]; // Use email prefix as name
                    user = {
                        id: Date.now(),
                        name: userName.charAt(0).toUpperCase() + userName.slice(1), // Capitalize first letter
                        email: email,
                        password: password,
                        joinDate: new Date().toISOString().split('T')[0],
                        birthday: "1995-03-15", // Demo birthday
                        birthdayBonusClaimed: false,
                        points: 650, // Demo points
                        currentTier: 1
                    };
                    
                    existingUsers.push(user);
                    localStorage.setItem('purpleRewardsUsers', JSON.stringify(existingUsers));
                }

                // Always successful login in demo mode
                authState.isAuthenticated = true;
                authState.currentUser = user;
                userData.name = user.name;
                userData.points = user.points;
                userData.currentTier = user.currentTier;
                userData.joinDate = user.joinDate;
                userData.birthday = user.birthday || "1995-03-15";
                userData.birthdayBonusClaimed = user.birthdayBonusClaimed || false;
                userData.isLoggedIn = true;
                
                localStorage.setItem('purpleRewardsUser', JSON.stringify(user));
                showNotification(`Welcome back, ${user.name}! 🎉`);
                showMainContent();
            }, 800);
        }

        function handleSignup(event) {
            event.preventDefault();
            
            if (!validateForm('signup')) {
                return;
            }

            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;

            const button = event.target.querySelector('.auth-button');
            button.disabled = true;
            button.textContent = 'Creating Account...';

            setTimeout(() => {
                // DEMO MODE: Always create account successfully
                const existingUsers = JSON.parse(localStorage.getItem('purpleRewardsUsers') || '[]');
                
                // Check if user exists and update, or create new
                let user = existingUsers.find(u => u.email === email);
                
                if (user) {
                    // Update existing user's name if different
                    user.name = name;
                } else {
                    // Create new demo user with some starter points
                    user = {
                        id: Date.now(),
                        name: name,
                        email: email,
                        password: password,
                        joinDate: new Date().toISOString().split('T')[0],
                        birthday: "1995-03-15", // Demo birthday
                        birthdayBonusClaimed: false,
                        points: 150, // Give new users some starter points for demo
                        currentTier: 1
                    };
                    existingUsers.push(user);
                }

                // Save to localStorage
                localStorage.setItem('purpleRewardsUsers', JSON.stringify(existingUsers));
                localStorage.setItem('purpleRewardsUser', JSON.stringify(user));

                // Update app state
                authState.isAuthenticated = true;
                authState.currentUser = user;
                userData.name = user.name;
                userData.points = user.points;
                userData.currentTier = user.currentTier;
                userData.joinDate = user.joinDate;
                userData.isLoggedIn = true;

                showNotification(`Welcome to Purple Rewards, ${user.name}! 🎉`);
                showMainContent();
            }, 800);
        }

        function socialLogin(provider) {
            // DEMO MODE: Simulate social login
            const demoUser = {
                id: Date.now(),
                name: `Demo User (${provider})`,
                email: `demo@${provider.toLowerCase()}.com`,
                password: 'demo123',
                joinDate: new Date().toISOString().split('T')[0],
                birthday: "1995-03-15", // Demo birthday
                birthdayBonusClaimed: false,
                points: 425, // Demo points
                currentTier: 1
            };

            // Save demo user
            const existingUsers = JSON.parse(localStorage.getItem('purpleRewardsUsers') || '[]');
            const userIndex = existingUsers.findIndex(u => u.email === demoUser.email);
            
            if (userIndex >= 0) {
                existingUsers[userIndex] = demoUser;
            } else {
                existingUsers.push(demoUser);
            }
            
            localStorage.setItem('purpleRewardsUsers', JSON.stringify(existingUsers));
            localStorage.setItem('purpleRewardsUser', JSON.stringify(demoUser));

            // Update app state
            authState.isAuthenticated = true;
            authState.currentUser = demoUser;
            userData.name = demoUser.name;
            userData.points = demoUser.points;
            userData.currentTier = demoUser.currentTier;
            userData.joinDate = demoUser.joinDate;
            userData.isLoggedIn = true;

            showNotification(`Welcome ${demoUser.name}! 🎉`);
            showMainContent();
        }

        function showForgotPassword() {
            showNotification('Password reset will be available soon! 📧');
        }

        function showAuthPage() {
            document.getElementById('authContainer').classList.add('active');
            document.getElementById('mainContent').classList.add('hidden');
        }

        function showMainContent() {
            document.getElementById('authContainer').classList.remove('active');
            document.getElementById('mainContent').classList.remove('hidden');
            updateUserDisplay();
        }

        function updateUserDisplay() {
            if (authState.currentUser) {
                document.getElementById('pointsDisplay').textContent = `${userData.points} Points`;
            }
        }

        function logout() {
            localStorage.removeItem('purpleRewardsUser');
            authState.isAuthenticated = false;
            authState.currentUser = null;
            userData.isLoggedIn = false;
            
            // Reset forms
            document.querySelectorAll('.auth-form').forEach(form => form.reset());
            clearAuthErrors();
            
            showNotification('You have been logged out successfully! 👋');
            showAuthPage();
        }

        // Add event listeners for forms
        document.getElementById('loginForm').addEventListener('submit', handleLogin);
        document.getElementById('signupForm').addEventListener('submit', handleSignup);

        // Initialize
        checkAuthState();
        updateProgress();

        function updateProgress() {
            // Ensure we have the correct target points for current tier
            const nextTier = userData.currentTier + 1;
            if (tiers[nextTier]) {
                userData.targetPoints = tiers[nextTier].minPoints;
            } else {
                userData.targetPoints = 20000; // Max level
            }
            
            // Calculate progress within current tier range
            const currentTierMinPoints = tiers[userData.currentTier].minPoints;
            const pointsInCurrentTier = userData.points - currentTierMinPoints;
            const pointsNeededForNextTier = userData.targetPoints - currentTierMinPoints;
            
            const progress = (pointsInCurrentTier / pointsNeededForNextTier) * 100;
            const clampedProgress = Math.max(0, Math.min(progress, 100));
            
            // Update progress bar
            const progressFillElement = document.getElementById('progressFill');
            if (progressFillElement) {
                progressFillElement.style.width = `${clampedProgress}%`;
                progressFillElement.textContent = 
                    `${Math.round(clampedProgress)}% to ${tiers[userData.currentTier + 1]?.name || 'Max Level'}`;
            }
            
            // Update progress info elements
            const currentPointsElement = document.getElementById('currentPointsDisplay');
            if (currentPointsElement) {
                currentPointsElement.textContent = `${userData.points.toLocaleString()} Points`;
            }
            
            const targetPointsElement = document.getElementById('targetPointsDisplay');
            if (targetPointsElement) {
                targetPointsElement.textContent = `${userData.targetPoints.toLocaleString()} Points`;
            }
            
            const pointsNeededElement = document.getElementById('pointsNeeded');
            if (pointsNeededElement) {
                const pointsNeeded = userData.targetPoints - userData.points;
                pointsNeededElement.textContent = `${pointsNeeded.toLocaleString()} points to go`;
            }
            
            const nextTierNameElement = document.getElementById('nextTierName');
            if (nextTierNameElement) {
                const nextTierInfo = tiers[userData.currentTier + 1];
                if (nextTierInfo) {
                    nextTierNameElement.textContent = `${nextTierInfo.icon} ${nextTierInfo.name}`;
                } else {
                    nextTierNameElement.textContent = '👑 Max Level Reached';
                }
            }
            
            // Update journey path progress
            const pathProgressElement = document.getElementById('pathProgress');
            if (pathProgressElement) {
                const pathProgress = (userData.currentTier - 1) * 33.33 + (clampedProgress / 100 * 33.33);
                pathProgressElement.style.width = `${Math.min(pathProgress, 100)}%`;
            }
        }

        function showTierDetails(tierId) {
            const tier = tiers[tierId];
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = `Tier ${tierId}: ${tier.name}`;
            
            modalBody.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 60px; margin-bottom: 10px;">${tier.icon}</div>
                    <p style="color: #666;">Minimum ${tier.minPoints} points required</p>
                </div>
                <h3 style="margin-bottom: 15px; color: #764ba2;">Benefits:</h3>
                <ul style="list-style: none; padding: 0;">
                    ${tier.benefits.map(benefit => 
                        `<li style="padding: 8px 0; padding-left: 25px; position: relative;">
                            <span style="position: absolute; left: 0; color: #4caf50;">✓</span>
                            ${benefit}
                        </li>`
                    ).join('')}
                </ul>
                ${tierId > userData.currentTier ? 
                    `<div style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 10px; text-align: center;">
                        <strong>${tier.minPoints - userData.points}</strong> more points needed to unlock this tier
                    </div>` : 
                    tierId === userData.currentTier ? 
                    '<div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 10px; text-align: center; color: #4caf50;">✓ This is your current tier</div>' :
                    '<div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 10px; text-align: center; color: #4caf50;">✓ Tier unlocked</div>'
                }
            `;
            
            modal.classList.add('active');
        }

        function showProfile() {
            console.log('showProfile called'); // Debug log
            
            // Update challenge progress for profile visit (only if challenges are initialized)
            if (typeof updateChallengeProgress === 'function') {
                updateChallengeProgress('profile');
            }
            
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            // Check if elements exist before trying to modify them
            if (!modal || !modalTitle || !modalBody) {
                console.error('Modal elements not found', { modal, modalTitle, modalBody });
                return;
            }
            
            console.log('Modal elements found, proceeding with profile display'); // Debug log
            
            // Reset modal content class to default
            const modalContent = modal.querySelector('.modal-content');
            if (modalContent) {
                modalContent.className = 'modal-content';
            }
            
            modalTitle.textContent = 'My Profile';
            
            modalBody.innerHTML = `
                <div style="padding: 20px;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #667eea, #764ba2); 
                                    border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; 
                                    justify-content: center; color: white; font-size: 36px;">
                            👤
                        </div>
                        <h3>${(authState && authState.currentUser && authState.currentUser.name) ? authState.currentUser.name : (userData && userData.name) ? userData.name : 'User'}</h3>
                        <p style="color: #666;">Member since ${userData && userData.joinDate ? new Date(userData.joinDate).toLocaleDateString() : 'Recently'}</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #764ba2;">${userData && userData.points ? userData.points : 0}</div>
                            <div style="color: #666; font-size: 14px;">Current Points</div>
                        </div>
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #764ba2;">${userData && userData.currentTier && tiers[userData.currentTier] ? tiers[userData.currentTier].icon : '⭐'}</div>
                            <div style="color: #666; font-size: 14px;">${userData && userData.currentTier && tiers[userData.currentTier] ? tiers[userData.currentTier].name : 'Rookie'}</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h4 style="margin-bottom: 10px;">Progress to Next Tier</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${userData && userData.points && userData.targetPoints ? (userData.points / userData.targetPoints) * 100 : 0}%">
                                ${userData && userData.targetPoints && userData.points ? userData.targetPoints - userData.points : 0} pts to go
                            </div>
                        </div>
                    </div>
                    
                    ${userData.doublePointsActive && userData.doublePointsExpiresAt && Date.now() < userData.doublePointsExpiresAt ? 
                        `<div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #ffc107, #ff9800); 
                                    border-radius: 10px; text-align: center; color: white;">
                            <div style="font-size: 18px; font-weight: bold;">⚡ Double Points Active!</div>
                            <div style="font-size: 14px; margin-top: 5px;">
                                Expires in ${Math.ceil((userData.doublePointsExpiresAt - Date.now()) / 60000)} minutes
                            </div>
                        </div>` : ''
                    }
                    
                    ${typeof getBirthdayBonusSection === 'function' ? getBirthdayBonusSection() : ''}
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" style="width: 100%;" onclick="closeModal()">Close</button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        function addPoints(basePoints, sourceLabel = 'Points') {
            let finalPoints = basePoints;
            const nowTs = Date.now();
            if (userData.doublePointsActive && userData.doublePointsExpiresAt && nowTs < userData.doublePointsExpiresAt) {
                finalPoints = basePoints * 2;
            } else {
                userData.doublePointsActive = false;
                userData.doublePointsExpiresAt = null;
            }

            userData.points += finalPoints;
            document.querySelector('.points-display').textContent = `${userData.points} Points`;
            updateProgress();
            checkTierUpgrade();
            
            // Update Holly Store points display
            const hollyStorePointsElement = document.getElementById('hollyStorePoints');
            if (hollyStorePointsElement) {
                hollyStorePointsElement.textContent = userData.points;
            }
            
            // Update challenge progress for point earning
            if (sourceLabel !== 'Challenge: Point Collector' && sourceLabel !== 'Challenge: Lucky Spinner' && 
                sourceLabel !== 'Challenge: Self Reflection' && sourceLabel !== 'Challenge: Window Shopper' &&
                sourceLabel !== 'Challenge: Competitor' && sourceLabel !== 'Challenge: Knowledge Seeker') {
                updateChallengeProgress('points', finalPoints);
            }
            
            showNotification(`+${finalPoints} ${sourceLabel}! 🎉`);
        }

        function getBirthdayBonusSection() {
            const today = new Date();
            const birthday = new Date(userData.birthday);
            const thisYearBirthday = new Date(today.getFullYear(), birthday.getMonth(), birthday.getDate());
            
            // If birthday has passed this year, check next year
            if (thisYearBirthday < today) {
                thisYearBirthday.setFullYear(today.getFullYear() + 1);
            }
            
            const daysUntilBirthday = Math.ceil((thisYearBirthday - today) / (1000 * 60 * 60 * 24));
            const birthdayMonth = birthday.toLocaleDateString('en-US', { month: 'long' });
            const birthdayDay = birthday.getDate();
            
            // Check if it's birthday week (7 days before or after)
            const isBirthdayWeek = daysUntilBirthday <= 7 || daysUntilBirthday >= 358; // 358 = 365-7 for last week of year
            const canClaim = isBirthdayWeek && !userData.birthdayBonusClaimed;
            
            if (canClaim) {
                return `
                    <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #e91e63, #ad1457); 
                                border-radius: 10px; text-align: center; color: white; position: relative; overflow: hidden;">
                        <div style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; 
                                    background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
                                    animation: shine 3s infinite;"></div>
                        <div style="font-size: 24px; margin-bottom: 8px;">🎂</div>
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 5px;">Birthday Bonus Available!</div>
                        <div style="font-size: 14px; margin-bottom: 15px; opacity: 0.9;">
                            Happy Birthday! Claim your special bonus
                        </div>
                        <button onclick="claimBirthdayBonus()" 
                                style="background: white; color: #e91e63; border: none; padding: 10px 20px; 
                                       border-radius: 20px; font-weight: bold; cursor: pointer; transition: all 0.3s ease;"
                                onmouseover="this.style.transform='scale(1.05)'"
                                onmouseout="this.style.transform='scale(1)'">
                            🎁 Claim Bonus
                        </button>
                    </div>
                `;
            } else if (userData.birthdayBonusClaimed && isBirthdayWeek) {
                return `
                    <div style="margin-top: 20px; padding: 15px; background: rgba(76, 175, 80, 0.1); 
                                border: 2px solid #4caf50; border-radius: 10px; text-align: center;">
                        <div style="font-size: 20px; margin-bottom: 8px;">🎂</div>
                        <div style="font-size: 16px; font-weight: bold; color: #4caf50; margin-bottom: 5px;">
                            Birthday Bonus Claimed!
                        </div>
                        <div style="font-size: 14px; color: #666;">
                            Thanks for celebrating with us! 🎉
                        </div>
                    </div>
                `;
            } else {
                const redeemableText = daysUntilBirthday <= 30 ? 
                    `Redeemable in ${daysUntilBirthday} days` : 
                    `Available on ${birthdayMonth} ${birthdayDay}`;
                    
                return `
                    <div style="margin-top: 20px; padding: 15px; background: rgba(233, 30, 99, 0.1); 
                                border: 2px solid #e91e63; border-radius: 10px; text-align: center;">
                        <div style="font-size: 20px; margin-bottom: 8px;">🎂</div>
                        <div style="font-size: 16px; font-weight: bold; color: #e91e63; margin-bottom: 5px;">
                            Birthday Bonus
                        </div>
                        <div style="font-size: 14px; color: #666; margin-bottom: 8px;">
                            Your birthday: ${birthdayMonth} ${birthdayDay}
                        </div>
                        <div style="font-size: 13px; color: #e91e63; font-weight: bold;">
                            ${redeemableText}
                        </div>
                        <div style="font-size: 12px; color: #999; margin-top: 5px;">
                            Bonus available 7 days before and after your birthday
                        </div>
                    </div>
                `;
            }
        }

        function claimBirthdayBonus() {
            if (userData.birthdayBonusClaimed) {
                showNotification('Birthday bonus already claimed this year!');
                return;
            }
            
            // Calculate bonus based on tier
            let bonusPoints = 100; // Base bonus
            if (userData.currentTier >= 2) bonusPoints = 200;
            if (userData.currentTier >= 3) bonusPoints = 350;
            if (userData.currentTier >= 4) bonusPoints = 500;
            
            // Mark as claimed
            userData.birthdayBonusClaimed = true;
            
            // Add bonus points
            addPoints(bonusPoints, 'Birthday Bonus');
            
            // Save to localStorage if user is logged in
            if (authState.currentUser) {
                authState.currentUser.birthdayBonusClaimed = true;
                authState.currentUser.points = userData.points;
                localStorage.setItem('purpleRewardsUser', JSON.stringify(authState.currentUser));
                
                const existingUsers = JSON.parse(localStorage.getItem('purpleRewardsUsers') || '[]');
                const userIndex = existingUsers.findIndex(u => u.id === authState.currentUser.id);
                if (userIndex >= 0) {
                    existingUsers[userIndex].birthdayBonusClaimed = true;
                    existingUsers[userIndex].points = userData.points;
                    localStorage.setItem('purpleRewardsUsers', JSON.stringify(existingUsers));
                }
            }
            
            // Close and reopen profile to refresh the display
            closeModal();
            setTimeout(() => showProfile(), 500);
            
            showNotification(`🎂 Happy Birthday! You received ${bonusPoints} bonus points! 🎉`);
        }

        function earnPoints() {
            const pointsEarned = Math.floor(Math.random() * 50) + 10;
            addPoints(pointsEarned, 'Points Earned');
        }

        function checkTierUpgrade() {
            for (let tierId = 4; tierId > userData.currentTier; tierId--) {
                if (userData.points >= tiers[tierId].minPoints) {
                    userData.currentTier = tierId;
                    userData.targetPoints = tiers[tierId + 1]?.minPoints || 20000;
                    showNotification(tiers[tierId].notification + ' 🎊');
                    updateMilestones();
                    break;
                }
            }
        }

        function updateMilestones() {
            const milestones = document.querySelectorAll('.milestone');
            milestones.forEach((milestone, index) => {
                milestone.classList.remove('completed', 'current');
                if (index < userData.currentTier) {
                    milestone.classList.add('completed');
                } else if (index === userData.currentTier) {
                    milestone.classList.add('current');
                }
            });
        }

        function viewRewards() {
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = 'Available Rewards';
            
            modalBody.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: grid; gap: 15px;">
                        <div style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 10px; cursor: pointer;"
                             onclick="claimReward('spin')">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 24px;">🎁</div>
                                    <strong>Daily Free Spin</strong>
                                    <p style="color: #666; font-size: 14px; margin: 5px 0;">Spin the wheel for prizes</p>
                                </div>
                                <button class="btn btn-primary">Claim</button>
                            </div>
                        </div>
                        
                        <div style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 24px;">💰</div>
                                    <strong>Cashback Bonus</strong>
                                    <p style="color: #666; font-size: 14px; margin: 5px 0;">2% back on losses</p>
                                </div>
                                <span style="color: #4caf50;">Active</span>
                            </div>
                        </div>
                        
                        <div style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 24px;">🏇</div>
                                    <strong>Horse Racing Tournament</strong>
                                    <p style="color: #666; font-size: 14px; margin: 5px 0;">Bet on horses and earn double points!</p>
                                    <p style="color: #764ba2; font-size: 12px; font-weight: bold;">⚡ Double points for 15 minutes after playing</p>
                                </div>
                                <button class="btn btn-secondary" onclick="openExternalHorseRacing()">Join</button>
                            </div>
                        </div>
                        
                        <div style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 24px;">🎰</div>
                                    <strong>Slots Tournament</strong>
                                    <p style="color: #666; font-size: 14px; margin: 5px 0;">Race to 10,000 points and earn double points!</p>
                                    <p style="color: #764ba2; font-size: 12px; font-weight: bold;">⚡ Double points for 15 minutes after playing</p>
                                </div>
                                <button class="btn btn-secondary" onclick="openExternalSlotsTournament()">Join</button>
                            </div>
                        </div>
                        
                        <div style="border: 2px solid #ffd700; padding: 15px; border-radius: 10px; background: rgba(255, 215, 0, 0.1);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 24px;">🎁</div>
                                    <strong>Prize Drops</strong>
                                    <p style="color: #666; font-size: 14px; margin: 5px 0;">Win amazing prizes just by betting!</p>
                                    <p style="color: #ffd700; font-size: 12px; font-weight: bold;">🏆 Air fryers, laptops, headphones & more!</p>
                                </div>
                                <button class="btn btn-secondary" onclick="triggerDemoPrizeDrop()" style="background: #ffd700; color: #333;">Demo</button>
                            </div>
                        </div>
                        
                        <div style="border: 2px solid #4caf50; padding: 15px; border-radius: 10px; background: rgba(76, 175, 80, 0.1);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 24px;">🍀</div>
                                    <strong>Lucky Pick</strong>
                                    <p style="color: #666; font-size: 14px; margin: 5px 0;">Pre-selected bets for novice bettors</p>
                                    <p style="color: #4caf50; font-size: 12px; font-weight: bold;">🎯 Algorithm picks the best bets for you!</p>
                                </div>
                                <button class="btn btn-secondary" onclick="showLuckyPick()" style="background: #4caf50; color: white;">Try Now</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        function claimReward(type) {
            if (type === 'spin') {
                closeModal();
                showSpinner();
            }
        }

        // Spinner functionality
        let isSpinning = false;
        let hasSpunToday = false;

        const spinRewards = [
            { name: '50 Points', icon: '💰', points: 50, description: 'Added to your account!' },
            { name: 'Free Spin', icon: '🎁', points: 0, description: 'Spin again tomorrow!' },
            { name: '100 Points', icon: '💎', points: 100, description: 'Nice win!' },
            { name: 'Bonus 2x', icon: '⚡', points: 0, description: 'Next deposit doubled!' },
            { name: '25 Points', icon: '🪙', points: 25, description: 'Better luck next time!' },
            { name: 'Cashback', icon: '💸', points: 0, description: '5% cashback activated!' },
            { name: '200 Points', icon: '🏆', points: 200, description: 'Excellent spin!' },
            { name: 'Jackpot!', icon: '🎰', points: 500, description: 'MEGA WIN! 500 Points!' }
        ];

        function showSpinner() {
            document.getElementById('spinnerOverlay').classList.add('active');
            // Update challenge progress for daily spin
            updateChallengeProgress('spin');
            document.getElementById('spinnerResult').classList.remove('show');
            document.getElementById('spinButton').disabled = false;
            document.getElementById('spinButton').textContent = '🎯 SPIN THE WHEEL!';
            
            // Reset wheel rotation
            document.getElementById('wheel').style.transform = 'rotate(0deg)';
        }

        function closeSpinner() {
            document.getElementById('spinnerOverlay').classList.remove('active');
            isSpinning = false;
        }

        function spinWheel() {
            if (isSpinning) return;
            
            isSpinning = true;
            const spinButton = document.getElementById('spinButton');
            const wheel = document.getElementById('wheel');
            
            spinButton.disabled = true;
            spinButton.textContent = '🌪️ SPINNING...';
            
            // Calculate random spin (multiple full rotations + random position)
            const minSpins = 5;
            const maxSpins = 8;
            const spins = Math.random() * (maxSpins - minSpins) + minSpins;
            const finalRotation = spins * 360;
            
            // Determine which segment wins (8 segments, 45 degrees each)
            const segmentAngle = 45;
            const winningSegmentIndex = Math.floor(Math.random() * 8);
            const segmentCenter = winningSegmentIndex * segmentAngle + (segmentAngle / 2);
            
            // Adjust rotation so the pointer lands on the winning segment
            const adjustedRotation = finalRotation - segmentCenter;
            
            wheel.style.transform = `rotate(${adjustedRotation}deg)`;
            
            // Show result after spin animation completes
            setTimeout(() => {
                showSpinResult(winningSegmentIndex);
                isSpinning = false;
                hasSpunToday = true;
            }, 3000);
        }

        function showSpinResult(segmentIndex) {
            const reward = spinRewards[segmentIndex];
            const resultDiv = document.getElementById('spinnerResult');
            const resultIcon = document.getElementById('resultIcon');
            const resultText = document.getElementById('resultText');
            const resultDescription = document.getElementById('resultDescription');
            
            resultIcon.textContent = reward.icon;
            resultText.textContent = `You won: ${reward.name}!`;
            resultDescription.textContent = reward.description;
            
            resultDiv.classList.add('show');
            
            // Apply the reward
            if (reward.points > 0) {
                addPoints(reward.points, 'Points from Spin');
                
                // Save to localStorage if user is logged in
                if (authState.currentUser) {
                    authState.currentUser.points = userData.points;
                    localStorage.setItem('purpleRewardsUser', JSON.stringify(authState.currentUser));
                    
                    // Update users array
                    const existingUsers = JSON.parse(localStorage.getItem('purpleRewardsUsers') || '[]');
                    const userIndex = existingUsers.findIndex(u => u.id === authState.currentUser.id);
                    if (userIndex >= 0) {
                        existingUsers[userIndex].points = userData.points;
                        localStorage.setItem('purpleRewardsUsers', JSON.stringify(existingUsers));
                    }
                }
            }
            
            // Update button
            const spinButton = document.getElementById('spinButton');
            spinButton.textContent = '✨ SPIN COMPLETE!';
            
            // Show celebration notification
            setTimeout(() => {
                showNotification(`🎉 ${reward.name} claimed! ${reward.description}`);
            }, 1000);
        }

        // Horse Racing Tournament functionality
        let selectedHorse = null;
        let currentBet = 0;
        let raceCountdown = 135; // 2m 15s in seconds
        let countdownInterval = null;

        const horses = [
            { id: 1, name: "Thunder Bolt", emoji: "⚡", winChance: 35, odds: 2.8, jockey: "Mike Johnson", record: "8-3-2" },
            { id: 2, name: "Midnight Star", emoji: "🌟", winChance: 28, odds: 3.5, jockey: "Sarah Wilson", record: "6-4-3" },
            { id: 3, name: "Golden Arrow", emoji: "🏹", winChance: 22, odds: 4.5, jockey: "Tom Rodriguez", record: "5-2-4" },
            { id: 4, name: "Storm Chaser", emoji: "🌪️", winChance: 15, odds: 6.7, jockey: "Lisa Chen", record: "3-5-2" }
        ];

        function showHorseRacing() {
            // Redirect externally instead of showing in-app betting UI
            openExternalHorseRacing();
        }

        function closeHorseRacing() {
            document.getElementById('horseRacingOverlay').classList.remove('active');
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            resetBetting();
        }

        function generateRaceInfo() {
            const now = new Date();
            const raceTime = new Date(now.getTime() + raceCountdown * 1000);
            const timeString = raceTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            document.getElementById('raceTime').textContent = timeString;
        }

        function startCountdown() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            countdownInterval = setInterval(() => {
                raceCountdown--;
                
                const minutes = Math.floor(raceCountdown / 60);
                const seconds = raceCountdown % 60;
                const timeString = `${minutes}m ${seconds.toString().padStart(2, '0')}s`;
                
                document.getElementById('countdown').textContent = timeString;
                
                if (raceCountdown <= 0) {
                    clearInterval(countdownInterval);
                    document.getElementById('countdown').textContent = "Race Starting!";
                    // In a real app, this would trigger the race
                }
            }, 1000);
        }

        function populateHorses() {
            const horsesGrid = document.getElementById('horsesGrid');
            horsesGrid.innerHTML = '';
            
            horses.forEach(horse => {
                const horseCard = document.createElement('div');
                horseCard.className = 'horse-card';
                horseCard.onclick = () => selectHorse(horse.id);
                
                horseCard.innerHTML = `
                    <div class="horse-header">
                        <div class="horse-name">${horse.emoji} ${horse.name}</div>
                        <div class="horse-odds">${horse.odds}:1</div>
                    </div>
                    <div class="horse-stats">
                        <span>Jockey: ${horse.jockey}</span>
                        <span>Record: ${horse.record}</span>
                    </div>
                    <div class="win-chance">
                        <div class="chance-bar">
                            <div class="chance-fill" style="width: ${horse.winChance}%"></div>
                        </div>
                        <div class="chance-percent">${horse.winChance}%</div>
                    </div>
                `;
                
                horsesGrid.appendChild(horseCard);
            });
        }

        function selectHorse(horseId) {
            selectedHorse = horseId;
            
            // Update visual selection
            document.querySelectorAll('.horse-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            const selectedCard = document.querySelectorAll('.horse-card')[horseId - 1];
            selectedCard.classList.add('selected');
            
            // Show betting section
            document.getElementById('betSection').style.display = 'block';
            
            // Reset bet input
            document.getElementById('betInput').value = '';
            updatePotentialWin();
        }

        function setBetAmount(amount) {
            if (!selectedHorse) return;
            
            // Check if user has enough points
            if (amount > userData.points) {
                showNotification(`Not enough points! You have ${userData.points} points.`);
                return;
            }
            
            document.getElementById('betInput').value = amount;
            currentBet = amount;
            updatePotentialWin();
        }

        function updatePotentialWin() {
            const betInput = document.getElementById('betInput');
            const betAmount = parseInt(betInput.value) || 0;
            currentBet = betAmount;
            
            if (betAmount > 0 && selectedHorse) {
                const horse = horses.find(h => h.id === selectedHorse);
                const potentialWin = Math.floor(betAmount * horse.odds);
                
                document.getElementById('potentialWinAmount').textContent = `${potentialWin} Points`;
                document.getElementById('potentialWin').style.display = 'block';
                document.getElementById('placeBetButton').disabled = false;
            } else {
                document.getElementById('potentialWin').style.display = 'none';
                document.getElementById('placeBetButton').disabled = true;
            }
        }

        function placeBet() {
            if (!selectedHorse || currentBet <= 0) return;
            
            if (currentBet > userData.points) {
                showNotification(`Not enough points! You have ${userData.points} points.`);
                return;
            }
            
            const horse = horses.find(h => h.id === selectedHorse);
            
            // Deduct bet amount
            userData.points -= currentBet;
            document.getElementById('pointsDisplay').textContent = `${userData.points} Points`;
            
            // Simulate race result
            setTimeout(() => {
                simulateRace(horse);
            }, 1000);
            
            // Update button
            document.getElementById('placeBetButton').textContent = '🏁 Race in Progress...';
            document.getElementById('placeBetButton').disabled = true;
            
            // Save points if user is logged in
            if (authState.currentUser) {
                authState.currentUser.points = userData.points;
                localStorage.setItem('purpleRewardsUser', JSON.stringify(authState.currentUser));
                
                const existingUsers = JSON.parse(localStorage.getItem('purpleRewardsUsers') || '[]');
                const userIndex = existingUsers.findIndex(u => u.id === authState.currentUser.id);
                if (userIndex >= 0) {
                    existingUsers[userIndex].points = userData.points;
                    localStorage.setItem('purpleRewardsUsers', JSON.stringify(existingUsers));
                }
            }
        }

        function simulateRace(selectedHorse) {
            // Simulate race based on win chances
            const random = Math.random() * 100;
            let cumulativeChance = 0;
            let winner = null;
            
            for (const horse of horses) {
                cumulativeChance += horse.winChance;
                if (random <= cumulativeChance) {
                    winner = horse;
                    break;
                }
            }
            
            // If no winner selected (edge case), pick the last horse
            if (!winner) winner = horses[horses.length - 1];
            
            const didWin = winner.id === selectedHorse.id;
            const winnings = didWin ? Math.floor(currentBet * selectedHorse.odds) : 0;
            
            if (didWin) {
                userData.points += winnings;
                document.getElementById('pointsDisplay').textContent = `${userData.points} Points`;
                updateProgress();
                checkTierUpgrade();
                
                showNotification(`🏆 ${winner.name} won! You earned ${winnings} points!`);
                
                // Save updated points
                if (authState.currentUser) {
                    authState.currentUser.points = userData.points;
                    localStorage.setItem('purpleRewardsUser', JSON.stringify(authState.currentUser));
                    
                    const existingUsers = JSON.parse(localStorage.getItem('purpleRewardsUsers') || '[]');
                    const userIndex = existingUsers.findIndex(u => u.id === authState.currentUser.id);
                    if (userIndex >= 0) {
                        existingUsers[userIndex].points = userData.points;
                        localStorage.setItem('purpleRewardsUsers', JSON.stringify(existingUsers));
                    }
                }
            } else {
                showNotification(`😔 ${winner.name} won the race. Better luck next time!`);
            }
            
            // Reset for next race
            setTimeout(() => {
                resetBetting();
                raceCountdown = 180; // 3 minutes for next race
                generateRaceInfo();
                startCountdown();
            }, 3000);
        }

        function resetBetting() {
            selectedHorse = null;
            currentBet = 0;
            document.getElementById('betSection').style.display = 'none';
            document.getElementById('betInput').value = '';
            document.getElementById('potentialWin').style.display = 'none';
            document.getElementById('placeBetButton').textContent = '🎯 Place Bet';
            document.getElementById('placeBetButton').disabled = true;
            
            document.querySelectorAll('.horse-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        // Slots Tournament functionality
        let slotsTournamentState = {
            isJoined: false,
            selectedSlot: null,
            tournamentPoints: 0,
            targetPoints: 10000,
            timeRemaining: 9900, // 2h 45m in seconds
            participants: []
        };

        const slotMachines = [
            { id: 1, name: "Hot Hot Hollywoodbets", icon: "🔥", rtp: 96.5, volatility: "High", minBet: 5, maxBet: 100, multipliers: [1, 2, 5, 10, 25, 50, 100, 250] },
            { id: 2, name: "Sweet Bonanza", icon: "🍭", rtp: 96.2, volatility: "Medium", minBet: 5, maxBet: 100, multipliers: [1, 2, 3, 8, 15, 30, 75, 200] },
            { id: 3, name: "Sahara Riches", icon: "🏜️", rtp: 95.8, volatility: "Medium", minBet: 5, maxBet: 100, multipliers: [1, 2, 4, 6, 12, 25, 60, 150] },
            { id: 4, name: "African Fortune", icon: "🦁", rtp: 96.8, volatility: "High", minBet: 5, maxBet: 100, multipliers: [1, 2, 5, 12, 20, 40, 80, 300] },
            { id: 5, name: "Hollywoodbets Chilli Heat", icon: "🌶️", rtp: 96.1, volatility: "Low", minBet: 5, maxBet: 100, multipliers: [1, 1.5, 3, 5, 10, 20, 50, 120] }
        ];

        function showSlotsTournament() {
            // Update challenge progress for tournament participation
            updateChallengeProgress('tournament');
            
            // Redirect externally instead of showing in-app tournament for betting
            openExternalSlotsTournament();
        }

        function closeSlotsTournament() {
            document.getElementById('slotsTournamentOverlay').classList.remove('active');
            if (slotsTournamentState.countdownInterval) {
                clearInterval(slotsTournamentState.countdownInterval);
            }
        }

        function initializeTournamentParticipants() {
            slotsTournamentState.participants = [
                { id: 1, name: "SpinMaster99", points: 8750, isCurrentUser: false },
                { id: 2, name: "LuckyPlayer", points: 7320, isCurrentUser: false },
                { id: 3, name: "SlotKing", points: 6890, isCurrentUser: false },
                { id: 4, name: "CasinoQueen", points: 5640, isCurrentUser: false },
                { id: 5, name: "BigWinner", points: 4920, isCurrentUser: false },
                { id: 6, name: userData.name || "You", points: slotsTournamentState.tournamentPoints, isCurrentUser: true }
            ];
        }

        function populateSlotMachines() {
            const slotsGrid = document.getElementById('slotsGrid');
            slotsGrid.innerHTML = '';
            
            slotMachines.forEach(slot => {
                const slotCard = document.createElement('div');
                slotCard.className = 'slot-machine';
                slotCard.onclick = () => selectSlotMachine(slot.id);
                
                const progress = Math.min((slotsTournamentState.tournamentPoints / slotsTournamentState.targetPoints) * 100, 100);
                
                slotCard.innerHTML = `
                    <div class="slot-header">
                        <div class="slot-name">${slot.name}</div>
                        <div class="slot-icon">${slot.icon}</div>
                    </div>
                    <div class="slot-stats">
                        <div class="stat-item">
                            <span class="stat-value">${slot.rtp}%</span>
                            <span class="stat-label">RTP</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">${slot.volatility}</span>
                            <span class="stat-label">Volatility</span>
                        </div>
                    </div>
                    <div class="slot-progress">
                        <div class="progress-label">
                            <span>Tournament Progress</span>
                            <span>${slotsTournamentState.tournamentPoints}/${slotsTournamentState.targetPoints}</span>
                        </div>
                        <div class="progress-bar-slot">
                            <div class="progress-fill-slot" style="width: ${progress}%"></div>
                        </div>
                    </div>
                `;
                
                slotsGrid.appendChild(slotCard);
            });
        }

        function selectSlotMachine(slotId) {
            if (!slotsTournamentState.isJoined) {
                showNotification('Please join the tournament first!');
                return;
            }

            slotsTournamentState.selectedSlot = slotId;
            
            document.querySelectorAll('.slot-machine').forEach(card => {
                card.classList.remove('selected');
            });
            
            const selectedCard = document.querySelectorAll('.slot-machine')[slotId - 1];
            selectedCard.classList.add('selected');
            
            document.getElementById('spinControls').classList.add('active');
            document.getElementById('spinInput').value = '';
            updateSpinButton();
        }

        function setSpinAmount(amount) {
            if (!slotsTournamentState.selectedSlot) return;
            
            if (amount > userData.points) {
                showNotification(`Not enough points! You have ${userData.points} points.`);
                return;
            }
            
            document.getElementById('spinInput').value = amount;
            updateSpinButton();
        }

        function updateSpinButton() {
            const spinInput = document.getElementById('spinInput');
            const spinButton = document.getElementById('spinSlotButton');
            const betAmount = parseInt(spinInput.value) || 0;
            
            if (betAmount > 0 && slotsTournamentState.selectedSlot && betAmount <= userData.points) {
                spinButton.disabled = false;
                spinButton.textContent = `🎰 SPIN (${betAmount} points)`;
            } else {
                spinButton.disabled = true;
                spinButton.textContent = '🎰 SPIN TO WIN!';
            }
        }

        function spinSlotMachine() {
            const betAmount = parseInt(document.getElementById('spinInput').value) || 0;
            if (!slotsTournamentState.selectedSlot || betAmount <= 0 || betAmount > userData.points) return;
            
            const slot = slotMachines.find(s => s.id === slotsTournamentState.selectedSlot);
            
            userData.points -= betAmount;
            document.getElementById('pointsDisplay').textContent = `${userData.points} Points`;
            
            const selectedCard = document.querySelectorAll('.slot-machine')[slotsTournamentState.selectedSlot - 1];
            selectedCard.classList.add('playing');
            
            const spinButton = document.getElementById('spinSlotButton');
            spinButton.disabled = true;
            spinButton.textContent = '🎰 SPINNING...';
            
            setTimeout(() => {
                simulateSlotSpin(slot, betAmount);
                selectedCard.classList.remove('playing');
                updateSpinButton();
            }, 2000);
            
            if (authState.currentUser) {
                authState.currentUser.points = userData.points;
                localStorage.setItem('purpleRewardsUser', JSON.stringify(authState.currentUser));
            }
        }

        function simulateSlotSpin(slot, betAmount) {
            const random = Math.random() * 100;
            const winChance = slot.rtp / 2;
            
            if (random <= winChance) {
                const multiplierIndex = Math.floor(Math.random() * slot.multipliers.length);
                const multiplier = slot.multipliers[multiplierIndex];
                const winAmount = Math.floor(betAmount * multiplier);
                const tournamentPoints = Math.floor(winAmount * 0.8);
                
                userData.points += winAmount;
                document.getElementById('pointsDisplay').textContent = `${userData.points} Points`;
                
                slotsTournamentState.tournamentPoints += tournamentPoints;
                
                updateProgress();
                checkTierUpgrade();
                updateTournamentProgress();
                updateLeaderboard();
                
                showNotification(`🎰 ${slot.icon} WIN! +${winAmount} points (+${tournamentPoints} tournament points)`);
                
                if (slotsTournamentState.tournamentPoints >= slotsTournamentState.targetPoints) {
                    showTournamentWin();
                }
            } else {
                const consolationPoints = Math.floor(betAmount * 0.1);
                slotsTournamentState.tournamentPoints += consolationPoints;
                
                updateTournamentProgress();
                updateLeaderboard();
                
                showNotification(`${slot.icon} No win this time. +${consolationPoints} tournament points for trying!`);
            }
        }

        function joinSlotsTournament() {
            slotsTournamentState.isJoined = true;
            slotsTournamentState.tournamentPoints = 0;
            
            document.getElementById('joinTournamentBtn').style.display = 'none';
            document.getElementById('leaveTournamentBtn').style.display = 'inline-block';
            
            const currentUserParticipant = slotsTournamentState.participants.find(p => p.isCurrentUser);
            if (currentUserParticipant) {
                currentUserParticipant.points = slotsTournamentState.tournamentPoints;
            }
            
            updateLeaderboard();
            populateSlotMachines();
            
            showNotification('🎰 Joined the slots tournament! Select a slot machine to start spinning!');
        }

        function leaveSlotsTournament() {
            slotsTournamentState.isJoined = false;
            slotsTournamentState.selectedSlot = null;
            slotsTournamentState.tournamentPoints = 0;
            
            document.getElementById('joinTournamentBtn').style.display = 'inline-block';
            document.getElementById('leaveTournamentBtn').style.display = 'none';
            document.getElementById('spinControls').classList.remove('active');
            
            document.querySelectorAll('.slot-machine').forEach(card => {
                card.classList.remove('selected');
            });
            
            updateLeaderboard();
            populateSlotMachines();
            
            showNotification('Left the slots tournament.');
        }

        function updateLeaderboard() {
            const currentUserParticipant = slotsTournamentState.participants.find(p => p.isCurrentUser);
            if (currentUserParticipant) {
                currentUserParticipant.points = slotsTournamentState.tournamentPoints;
            }
            
            const sortedParticipants = [...slotsTournamentState.participants].sort((a, b) => b.points - a.points);
            
            const leaderboardList = document.getElementById('leaderboardList');
            leaderboardList.innerHTML = '';
            
            sortedParticipants.forEach((participant, index) => {
                const item = document.createElement('div');
                item.className = `leaderboard-item ${participant.isCurrentUser ? 'current-user' : ''}`;
                
                let rankClass = '';
                if (index === 0) rankClass = 'gold';
                else if (index === 1) rankClass = 'silver';
                else if (index === 2) rankClass = 'bronze';
                
                item.innerHTML = `
                    <div class="player-info">
                        <div class="player-rank ${rankClass}">${index + 1}</div>
                        <div class="player-name">${participant.name}</div>
                    </div>
                    <div class="player-points">${participant.points.toLocaleString()} pts</div>
                `;
                
                leaderboardList.appendChild(item);
            });
        }

        function updateTournamentProgress() {
            const progress = Math.min((slotsTournamentState.tournamentPoints / slotsTournamentState.targetPoints) * 100, 100);
            
            document.querySelectorAll('.progress-fill-slot').forEach(fill => {
                fill.style.width = `${progress}%`;
            });
            
            document.querySelectorAll('.progress-label span:last-child').forEach(label => {
                label.textContent = `${slotsTournamentState.tournamentPoints}/${slotsTournamentState.targetPoints}`;
            });
        }

        function startTournamentCountdown() {
            if (slotsTournamentState.countdownInterval) {
                clearInterval(slotsTournamentState.countdownInterval);
            }
            
            slotsTournamentState.countdownInterval = setInterval(() => {
                slotsTournamentState.timeRemaining--;
                
                const hours = Math.floor(slotsTournamentState.timeRemaining / 3600);
                const minutes = Math.floor((slotsTournamentState.timeRemaining % 3600) / 60);
                const timeString = `${hours}h ${minutes}m remaining`;
                
                document.getElementById('timeRemaining').textContent = timeString;
                
                if (slotsTournamentState.timeRemaining <= 0) {
                    clearInterval(slotsTournamentState.countdownInterval);
                    document.getElementById('timeRemaining').textContent = "Tournament Ended!";
                }
            }, 1000);
        }

        function updateTournamentUI() {
            if (slotsTournamentState.isJoined) {
                document.getElementById('joinTournamentBtn').style.display = 'none';
                document.getElementById('leaveTournamentBtn').style.display = 'inline-block';
            } else {
                document.getElementById('joinTournamentBtn').style.display = 'inline-block';
                document.getElementById('leaveTournamentBtn').style.display = 'none';
                document.getElementById('spinControls').classList.remove('active');
            }
        }

        function showTournamentWin() {
            const bonusPoints = 2500;
            userData.points += bonusPoints;
            document.getElementById('pointsDisplay').textContent = `${userData.points} Points`;
            
            updateProgress();
            checkTierUpgrade();
            
            if (authState.currentUser) {
                authState.currentUser.points = userData.points;
                localStorage.setItem('purpleRewardsUser', JSON.stringify(authState.currentUser));
            }
            
            showNotification(`🏆 TOURNAMENT WON! You reached 10,000 points first! +${bonusPoints} bonus points!`);
            
            setTimeout(() => {
                leaveSlotsTournament();
                closeSlotsTournament();
            }, 3000);
        }

        // Add event listener for bet input
        document.addEventListener('DOMContentLoaded', function() {
            const betInput = document.getElementById('betInput');
            if (betInput) {
                betInput.addEventListener('input', updatePotentialWin);
            }
            
            const spinInput = document.getElementById('spinInput');
            if (spinInput) {
                spinInput.addEventListener('input', updateSpinButton);
            }
        });

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.2);
                z-index: 2000;
                animation: slideIn 0.3s ease;
                font-weight: 600;
                color: #764ba2;
                max-width: 300px;
                word-wrap: break-word;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            const modalContent = modal.querySelector('.modal-content');
            
            modal.classList.remove('active');
            
            // Reset modal content class to default
            modalContent.className = 'modal-content';
        }

        // Close modal on background click
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                closeModal();
            }
        });

        // Add animation styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideOut {
                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // Prize Drop System
        const prizeDrops = [
            { name: "Air Fryer", icon: "🍟", description: "Delicious healthy cooking made easy!", value: "R1,500", rarity: "rare" },
            { name: "Coffee Machine", icon: "☕", description: "Barista-quality coffee at home", value: "R2,000", rarity: "rare" },
            { name: "Bluetooth Headphones", icon: "🎧", description: "Premium wireless audio experience", value: "R800", rarity: "common" },
            { name: "Smart Watch", icon: "⌚", description: "Stay connected and track your fitness", value: "R1,200", rarity: "uncommon" },
            { name: "Gaming Chair", icon: "🪑", description: "Ultimate comfort for gaming sessions", value: "R2,500", rarity: "rare" },
            { name: "Tablet", icon: "📱", description: "Portable entertainment and productivity", value: "R3,000", rarity: "epic" },
            { name: "Wireless Speaker", icon: "🔊", description: "High-quality sound anywhere", value: "R600", rarity: "common" },
            { name: "Electric Kettle", icon: "🫖", description: "Quick and efficient water heating", value: "R400", rarity: "common" },
            { name: "Fitness Tracker", icon: "⌚", description: "Monitor your health and activity", value: "R900", rarity: "uncommon" },
            { name: "Microwave Oven", icon: "📦", description: "Quick and convenient cooking", value: "R1,800", rarity: "rare" },
            { name: "Laptop", icon: "💻", description: "Powerful computing on the go", value: "R8,000", rarity: "legendary" },
            { name: "TV Streaming Device", icon: "📺", description: "Transform any TV into a smart TV", value: "R500", rarity: "common" },
            { name: "Vacuum Cleaner", icon: "🧹", description: "Keep your home spotless", value: "R1,200", rarity: "uncommon" },
            { name: "Blender", icon: "🥤", description: "Perfect smoothies and shakes", value: "R700", rarity: "common" },
            { name: "Electric Grill", icon: "🔥", description: "Indoor grilling made simple", value: "R1,100", rarity: "uncommon" }
        ];

        const prizeRarities = {
            common: { weight: 50, color: "#4caf50" },
            uncommon: { weight: 30, color: "#2196f3" },
            rare: { weight: 15, color: "#9c27b0" },
            epic: { weight: 4, color: "#ff9800" },
            legendary: { weight: 1, color: "#f44336" }
        };

        let prizeDropState = {
            lastPrizeDrop: 0,
            totalBets: 0,
            prizeDropChance: 0.05 // 5% base chance per bet
        };

        function checkForPrizeDrop() {
            prizeDropState.totalBets++;
            
            // Increase chance slightly with each bet without a prize
            const timeSinceLastPrize = Date.now() - prizeDropState.lastPrizeDrop;
            const bonusChance = Math.min(timeSinceLastPrize / (1000 * 60 * 10), 0.1); // Max 10% bonus after 10 minutes
            const totalChance = prizeDropState.prizeDropChance + bonusChance;
            
            if (Math.random() < totalChance) {
                triggerPrizeDrop();
                prizeDropState.lastPrizeDrop = Date.now();
                return true;
            }
            return false;
        }

        function triggerPrizeDrop() {
            const prize = selectRandomPrize();
            showPrizeDrop(prize);
            createConfetti();
        }

        function selectRandomPrize() {
            // Calculate total weight
            let totalWeight = 0;
            prizeDrops.forEach(prize => {
                totalWeight += prizeRarities[prize.rarity].weight;
            });
            
            // Select random prize based on rarity weights
            let random = Math.random() * totalWeight;
            let currentWeight = 0;
            
            for (const prize of prizeDrops) {
                currentWeight += prizeRarities[prize.rarity].weight;
                if (random <= currentWeight) {
                    return prize;
                }
            }
            
            // Fallback to first prize
            return prizeDrops[0];
        }

        function showPrizeDrop(prize) {
            document.getElementById('prizeIcon').textContent = prize.icon;
            document.getElementById('prizeName').textContent = prize.name;
            document.getElementById('prizeDescription').textContent = prize.description;
            document.getElementById('prizeValue').textContent = `Value: ${prize.value}`;
            
            // Set rarity color
            const prizeItem = document.getElementById('prizeItem');
            prizeItem.style.background = `linear-gradient(135deg, ${prizeRarities[prize.rarity].color}, #764ba2)`;
            
            document.getElementById('prizeDropOverlay').classList.add('active');
            
            // Play prize drop sound effect (if you want to add audio)
            showNotification(`🎉 PRIZE DROP! You won a ${prize.name}!`);
        }

        function createConfetti() {
            const container = document.querySelector('.prize-drop-container');
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                container.appendChild(confetti);
                
                // Remove confetti after animation
                setTimeout(() => {
                    if (confetti.parentNode) {
                        confetti.parentNode.removeChild(confetti);
                    }
                }, 5000);
            }
        }

        function closePrizeDrop() {
            document.getElementById('prizeDropOverlay').classList.remove('active');
        }

        function claimPrize() {
            const prizeName = document.getElementById('prizeName').textContent;
            showNotification(`🏆 Prize claimed! Your ${prizeName} will be delivered within 5-7 business days!`);
            
            // Award bonus points for claiming
            addPoints(100, 'Prize Claim Bonus');
            
            closePrizeDrop();
        }

        function continueBetting() {
            closePrizeDrop();
            // Could redirect to external betting or show tournament options
            showNotification('🎰 Keep playing for more prize drops!');
        }

        // External betting redirects with double-points activation
        function activateDoublePoints(minutes = 15) {
            const expiresInMs = minutes * 60 * 1000;
            userData.doublePointsActive = true;
            userData.doublePointsExpiresAt = Date.now() + expiresInMs;
            showNotification(`⚡ Double points active for ${minutes} minutes after external play!`);
        }

        function openExternalHorseRacing() {
            closeModal();
            const url = 'https://example.com/external/horse-racing-demo';
            window.open(url, '_blank', 'noopener');
            activateDoublePoints(15);
            
            // Check for prize drop when betting on selected games
            setTimeout(() => {
                if (checkForPrizeDrop()) {
                    // Prize drop triggered!
                }
            }, 2000); // Simulate betting delay
        }

        function openExternalSlotsTournament() {
            closeModal();
            const url = 'https://example.com/external/slots-tournament-demo';
            window.open(url, '_blank', 'noopener');
            activateDoublePoints(15);
            
            // Check for prize drop when betting on selected games
            setTimeout(() => {
                if (checkForPrizeDrop()) {
                    // Prize drop triggered!
                }
            }, 2000); // Simulate betting delay
        }

        // Add demo prize drop trigger for testing
        function triggerDemoPrizeDrop() {
            triggerPrizeDrop();
        }

        // Daily Challenges System
        let challengesData = {
            currentStreak: 0,
            lastCompletionDate: null,
            todaysChallenges: [],
            completedChallenges: [],
            streakMilestones: [3, 7, 14, 30, 60, 100]
        };

        const challengeTemplates = [
            {
                id: 'daily_spin',
                icon: '🎰',
                title: 'Lucky Spinner',
                description: 'Complete your daily free spin',
                target: 1,
                reward: 50,
                action: 'spin'
            },
            {
                id: 'earn_points',
                icon: '💎',
                title: 'Point Collector',
                description: 'Earn 100 points today',
                target: 100,
                reward: 75,
                action: 'points'
            },
            {
                id: 'visit_store',
                icon: '🛍️',
                title: 'Window Shopper',
                description: 'Visit the Holly Store',
                target: 1,
                reward: 30,
                action: 'store'
            },
            {
                id: 'check_profile',
                icon: '👤',
                title: 'Self Reflection',
                description: 'Check your profile',
                target: 1,
                reward: 25,
                action: 'profile'
            },
            {
                id: 'tournament_join',
                icon: '🏆',
                title: 'Competitor',
                description: 'Join a tournament or betting activity',
                target: 1,
                reward: 100,
                action: 'tournament'
            },
            {
                id: 'faq_explore',
                icon: '❓',
                title: 'Knowledge Seeker',
                description: 'Explore the FAQ section',
                target: 1,
                reward: 40,
                action: 'faq'
            }
        ];

        function initializeChallenges() {
            loadChallengesData();
            checkDailyReset();
            generateDailyChallenges();
            updateChallengesDisplay();
            updateStreakDisplay();
            updateMilestonesDisplay();
        }

        function loadChallengesData() {
            const saved = localStorage.getItem('purpleRewardsChallenges');
            if (saved) {
                challengesData = { ...challengesData, ...JSON.parse(saved) };
            }
        }

        function saveChallengesData() {
            localStorage.setItem('purpleRewardsChallenges', JSON.stringify(challengesData));
        }

        function checkDailyReset() {
            const today = new Date().toDateString();
            const lastDate = challengesData.lastCompletionDate;
            
            if (lastDate !== today) {
                // Check if streak should continue or reset
                if (lastDate) {
                    const lastDateObj = new Date(lastDate);
                    const todayObj = new Date(today);
                    const diffTime = Math.abs(todayObj - lastDateObj);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays > 1) {
                        // Streak broken
                        challengesData.currentStreak = 0;
                        showNotification('💔 Your streak was broken! Start a new one today.');
                    }
                }
                
                // Reset daily challenges
                challengesData.todaysChallenges = [];
                challengesData.completedChallenges = [];
            }
        }

        function generateDailyChallenges() {
            if (challengesData.todaysChallenges.length === 0) {
                // Generate 3-4 random challenges for today
                const numChallenges = Math.floor(Math.random() * 2) + 3; // 3 or 4 challenges
                const availableTemplates = [...challengeTemplates];
                const selectedChallenges = [];
                
                for (let i = 0; i < numChallenges && availableTemplates.length > 0; i++) {
                    const randomIndex = Math.floor(Math.random() * availableTemplates.length);
                    const template = availableTemplates.splice(randomIndex, 1)[0];
                    
                    selectedChallenges.push({
                        ...template,
                        progress: 0,
                        completed: false,
                        id: `${template.id}_${Date.now()}_${i}`
                    });
                }
                
                challengesData.todaysChallenges = selectedChallenges;
                saveChallengesData();
            }
        }

        function updateChallengesDisplay() {
            const container = document.getElementById('challengesGrid');
            if (!container) return;
            
            container.innerHTML = challengesData.todaysChallenges.map(challenge => {
                const progressPercent = Math.min((challenge.progress / challenge.target) * 100, 100);
                const isCompleted = challenge.completed;
                
                return `
                    <div class="challenge-card ${isCompleted ? 'completed' : ''}" data-challenge-id="${challenge.id}">
                        <div class="challenge-header">
                            <div class="challenge-icon">${challenge.icon}</div>
                            <div class="challenge-info">
                                <h4>${challenge.title}</h4>
                                <p>${challenge.description}</p>
                            </div>
                        </div>
                        
                        <div class="challenge-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                            <div class="progress-text">
                                <span>${challenge.progress}/${challenge.target}</span>
                                <span>${Math.round(progressPercent)}%</span>
                            </div>
                        </div>
                        
                        <div class="challenge-reward">
                            <div class="reward-points">+${challenge.reward} pts</div>
                            <button class="challenge-btn" 
                                    onclick="triggerChallengeAction('${challenge.action}')"
                                    ${isCompleted ? 'disabled' : ''}>
                                ${isCompleted ? 'Completed' : 'Start'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateStreakDisplay() {
            const streakElement = document.getElementById('streakCount');
            if (streakElement) {
                streakElement.textContent = challengesData.currentStreak;
            }
        }

        function updateMilestonesDisplay() {
            const container = document.getElementById('milestonesGrid');
            if (!container) return;
            
            container.innerHTML = challengesData.streakMilestones.map(milestone => {
                const isAchieved = challengesData.currentStreak >= milestone;
                const isCurrent = challengesData.currentStreak < milestone && 
                                 (challengesData.streakMilestones.find(m => challengesData.currentStreak >= m && challengesData.currentStreak < milestone) === undefined ||
                                  milestone === challengesData.streakMilestones.find(m => m > challengesData.currentStreak));
                
                let className = 'milestone';
                if (isAchieved) className += ' achieved';
                else if (isCurrent) className += ' current';
                
                const reward = milestone * 10; // 10 points per day milestone
                
                return `
                    <div class="${className}">
                        <div class="milestone-day">${milestone}</div>
                        <div class="milestone-reward">+${reward} pts</div>
                    </div>
                `;
            }).join('');
        }

        function triggerChallengeAction(action) {
            switch (action) {
                case 'spin':
                    showSpinner();
                    break;
                case 'points':
                    earnPoints();
                    break;
                case 'store':
                    openHollyStore();
                    break;
                case 'profile':
                    showProfile();
                    break;
                case 'tournament':
                    showSlotsTournament();
                    break;
                case 'faq':
                    const faqSection = document.getElementById('faqSection');
                    if (faqSection.classList.contains('collapsed')) {
                        toggleFAQSection();
                    }
                    break;
            }
        }

        function updateChallengeProgress(action, amount = 1) {
            let updated = false;
            
            challengesData.todaysChallenges.forEach(challenge => {
                if (challenge.action === action && !challenge.completed) {
                    challenge.progress = Math.min(challenge.progress + amount, challenge.target);
                    
                    if (challenge.progress >= challenge.target && !challenge.completed) {
                        challenge.completed = true;
                        completeChallengeReward(challenge);
                        updated = true;
                    }
                }
            });
            
            if (updated) {
                checkAllChallengesComplete();
                updateChallengesDisplay();
                saveChallengesData();
            }
        }

        function completeChallengeReward(challenge) {
            addPoints(challenge.reward, `Challenge: ${challenge.title}`);
            showNotification(`🎯 Challenge completed! ${challenge.title} (+${challenge.reward} points)`);
        }

        function checkAllChallengesComplete() {
            const allCompleted = challengesData.todaysChallenges.every(c => c.completed);
            
            if (allCompleted && challengesData.todaysChallenges.length > 0) {
                // All challenges completed for the day
                challengesData.currentStreak++;
                challengesData.lastCompletionDate = new Date().toDateString();
                
                // Check for streak milestone rewards
                if (challengesData.streakMilestones.includes(challengesData.currentStreak)) {
                    const milestoneReward = challengesData.currentStreak * 10;
                    addPoints(milestoneReward, `${challengesData.currentStreak}-Day Streak Milestone`);
                    showNotification(`🔥 ${challengesData.currentStreak}-day streak milestone! (+${milestoneReward} bonus points)`);
                }
                
                updateStreakDisplay();
                updateMilestonesDisplay();
                saveChallengesData();
                
                showNotification(`🎉 All daily challenges completed! Streak: ${challengesData.currentStreak} days`);
            }
        }

        // Holly Store System
        const hollyStoreItems = {
            travel: {
                name: "Travel & Flights",
                icon: "✈️",
                description: "Flight discounts and travel perks",
                items: [
                    {
                        id: "flysafair_5",
                        name: "FlySafair 5% Discount",
                        description: "5% off any FlySafair domestic flight",
                        points: 500,
                        minTier: 1,
                        discount: "5%",
                        partner: "FlySafair"
                    },
                    {
                        id: "flysafair_10",
                        name: "FlySafair 10% Discount",
                        description: "10% off any FlySafair domestic flight",
                        points: 800,
                        minTier: 2,
                        discount: "10%",
                        partner: "FlySafair"
                    },
                    {
                        id: "flysafair_15",
                        name: "FlySafair 15% Discount",
                        description: "15% off any FlySafair flight + priority boarding",
                        points: 1200,
                        minTier: 3,
                        discount: "15%",
                        partner: "FlySafair"
                    },
                    {
                        id: "flysafair_20",
                        name: "FlySafair 20% Discount + Lounge",
                        description: "20% off any flight + airport lounge access",
                        points: 2000,
                        minTier: 4,
                        discount: "20%",
                        partner: "FlySafair"
                    }
                ]
            },
            dining: {
                name: "Dining & Food",
                icon: "🍽️",
                description: "Restaurant discounts and food delivery",
                items: [
                    {
                        id: "uber_eats_10",
                        name: "Uber Eats 10% Off",
                        description: "10% discount on your next Uber Eats order",
                        points: 200,
                        minTier: 1,
                        discount: "10%",
                        partner: "Uber Eats"
                    },
                    {
                        id: "uber_eats_15",
                        name: "Uber Eats 15% Off",
                        description: "15% discount + free delivery",
                        points: 350,
                        minTier: 2,
                        discount: "15%",
                        partner: "Uber Eats"
                    },
                    {
                        id: "restaurant_20",
                        name: "Premium Restaurant 20% Off",
                        description: "20% off at selected premium restaurants",
                        points: 600,
                        minTier: 3,
                        discount: "20%",
                        partner: "Premium Partners"
                    },
                    {
                        id: "fine_dining_25",
                        name: "Fine Dining 25% Off",
                        description: "25% off fine dining + complimentary wine",
                        points: 1000,
                        minTier: 4,
                        discount: "25%",
                        partner: "Fine Dining Partners"
                    }
                ]
            },
            shopping: {
                name: "Shopping & Retail",
                icon: "🛒",
                description: "Discounts at popular retailers",
                items: [
                    {
                        id: "takealot_5",
                        name: "Takealot 5% Discount",
                        description: "5% off your next Takealot purchase",
                        points: 300,
                        minTier: 1,
                        discount: "5%",
                        partner: "Takealot"
                    },
                    {
                        id: "woolworths_10",
                        name: "Woolworths 10% Off",
                        description: "10% discount on fashion and homeware",
                        points: 500,
                        minTier: 2,
                        discount: "10%",
                        partner: "Woolworths"
                    },
                    {
                        id: "exclusive_15",
                        name: "Exclusive Books 15% Off",
                        description: "15% off books, stationery, and gifts",
                        points: 400,
                        minTier: 2,
                        discount: "15%",
                        partner: "Exclusive Books"
                    },
                    {
                        id: "luxury_20",
                        name: "Luxury Brands 20% Off",
                        description: "20% off luxury fashion and accessories",
                        points: 1500,
                        minTier: 4,
                        discount: "20%",
                        partner: "Luxury Partners"
                    }
                ]
            },
            entertainment: {
                name: "Entertainment",
                icon: "🎬",
                description: "Movies, shows, and entertainment",
                items: [
                    {
                        id: "ster_kinekor_2for1",
                        name: "Ster-Kinekor 2-for-1",
                        description: "Buy one movie ticket, get one free",
                        points: 400,
                        minTier: 1,
                        discount: "50%",
                        partner: "Ster-Kinekor"
                    },
                    {
                        id: "showmax_free",
                        name: "Showmax 1 Month Free",
                        description: "Free month of Showmax subscription",
                        points: 600,
                        minTier: 2,
                        discount: "100%",
                        partner: "Showmax"
                    },
                    {
                        id: "concerts_15",
                        name: "Concert Tickets 15% Off",
                        description: "15% discount on concert and show tickets",
                        points: 800,
                        minTier: 3,
                        discount: "15%",
                        partner: "Ticketpro"
                    },
                    {
                        id: "vip_experience",
                        name: "VIP Entertainment Package",
                        description: "VIP access to events + premium seating",
                        points: 2500,
                        minTier: 4,
                        discount: "VIP",
                        partner: "Premium Events"
                    }
                ]
            }
        };

        function initializeHollyStore() {
            populateStoreCategories();
            updateStoreDisplay();
        }

        function populateStoreCategories() {
            const container = document.getElementById('storeCategories');
            container.innerHTML = '';

            Object.keys(hollyStoreItems).forEach(categoryKey => {
                const category = hollyStoreItems[categoryKey];
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'store-category';

                categoryDiv.innerHTML = `
                    <div class="category-header">
                        <div class="category-icon">${category.icon}</div>
                        <div class="category-info">
                            <h3>${category.name}</h3>
                            <p>${category.description}</p>
                        </div>
                    </div>
                    <div class="store-items">
                        ${category.items.map(item => createStoreItemHTML(item)).join('')}
                    </div>
                `;

                container.appendChild(categoryDiv);
            });
        }

        function createStoreItemHTML(item) {
            const canRedeem = userData.currentTier >= item.minTier && userData.points >= item.points;
            const tierLocked = userData.currentTier < item.minTier;
            const pointsInsufficient = userData.currentTier >= item.minTier && userData.points < item.points;

            let itemClass = 'store-item';
            if (tierLocked) itemClass += ' tier-locked';
            else if (pointsInsufficient) itemClass += ' points-insufficient';

            let buttonText = 'Redeem';
            let buttonDisabled = false;

            if (tierLocked) {
                buttonText = `Tier ${item.minTier}+`;
                buttonDisabled = true;
            } else if (pointsInsufficient) {
                buttonText = 'Not Enough';
                buttonDisabled = true;
            }

            return `
                <div class="${itemClass}">
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-description">${item.description}</div>
                        <div class="item-tier-req">
                            ${tiers[item.minTier].icon} ${tiers[item.minTier].name}+ Required
                        </div>
                    </div>
                    <div class="item-price">
                        <div class="price-points">${item.points} pts</div>
                        <button class="redeem-btn" 
                                onclick="redeemStoreItem('${item.id}')" 
                                ${buttonDisabled ? 'disabled' : ''}>
                            ${buttonText}
                        </button>
                    </div>
                </div>
            `;
        }

        function updateStoreDisplay() {
            document.getElementById('currentStoreTier').textContent = tiers[userData.currentTier].name;
            document.getElementById('currentStorePoints').textContent = userData.points;
            
            // Refresh the store items to update availability
            populateStoreCategories();
        }

        function redeemStoreItem(itemId) {
            // Find the item across all categories
            let item = null;
            let categoryKey = null;

            for (const [key, category] of Object.entries(hollyStoreItems)) {
                const foundItem = category.items.find(i => i.id === itemId);
                if (foundItem) {
                    item = foundItem;
                    categoryKey = key;
                    break;
                }
            }

            if (!item) {
                showNotification('Item not found!');
                return;
            }

            // Check if user can redeem
            if (userData.currentTier < item.minTier) {
                showNotification(`You need to be ${tiers[item.minTier].name} tier or higher to redeem this item!`);
                return;
            }

            if (userData.points < item.points) {
                showNotification(`Not enough points! You need ${item.points} points but only have ${userData.points}.`);
                return;
            }

            // Deduct points
            userData.points -= item.points;
            document.getElementById('pointsDisplay').textContent = `${userData.points} Points`;

            // Save points if user is logged in
            if (authState.currentUser) {
                authState.currentUser.points = userData.points;
                localStorage.setItem('purpleRewardsUser', JSON.stringify(authState.currentUser));

                const existingUsers = JSON.parse(localStorage.getItem('purpleRewardsUsers') || '[]');
                const userIndex = existingUsers.findIndex(u => u.id === authState.currentUser.id);
                if (userIndex >= 0) {
                    existingUsers[userIndex].points = userData.points;
                    localStorage.setItem('purpleRewardsUsers', JSON.stringify(existingUsers));
                }
            }

            // Update Holly Store points display
            const hollyStorePointsElement = document.getElementById('hollyStorePoints');
            if (hollyStorePointsElement) {
                hollyStorePointsElement.textContent = userData.points;
            }

            // Refresh Holly Store modal if open
            if (document.getElementById('hollyStoreCategories')) {
                populateHollyStoreModal();
            }

            // Show success message
            showNotification(`🛍️ ${item.name} redeemed! Check your email for the discount code.`);

            // Simulate sending discount code
            setTimeout(() => {
                showNotification(`📧 Discount code sent! Use code: HOLLY${Math.random().toString(36).substr(2, 6).toUpperCase()}`);
            }, 2000);
        }

        // FAQ System
        const faqData = [
            // Points & Tiers
            {
                id: 1,
                category: 'points',
                question: 'How do I earn points in Purple Rewards?',
                answer: `You can earn points in several ways:
                <ul>
                    <li><strong>Daily Activities:</strong> Earn 10-50 points by clicking "Earn More Points"</li>
                    <li><strong>Daily Spin Wheel:</strong> Win 25-500 points from the free daily spin</li>
                    <li><strong>Tournament Participation:</strong> Get double points for 15-20 minutes after joining tournaments</li>
                    <li><strong>Lucky Pick Betting:</strong> Earn points from successful bets</li>
                    <li><strong>Birthday Bonus:</strong> Get 100-500 points on your birthday (tier-based)</li>
                    <li><strong>Prize Claims:</strong> Receive 100 bonus points when claiming physical prizes</li>
                </ul>`
            },
            {
                id: 2,
                category: 'points',
                question: 'What are the different tiers and how do I advance?',
                answer: `Purple Rewards has 4 tiers with increasing benefits:
                <ul>
                    <li><strong>⭐ Rookie (0+ points):</strong> Entry level with basic rewards</li>
                    <li><strong>🎯 Power Player (1,000+ points):</strong> Enhanced bonuses and priority support</li>
                    <li><strong>🎰 Spin Master (5,000+ points):</strong> Exclusive tournaments and personalized promotions</li>
                    <li><strong>👑 High Roller (10,000+ points):</strong> VIP treatment with dedicated account manager</li>
                </ul>
                <strong>Advance by accumulating points through activities and maintaining your balance.</strong>`
            },
            {
                id: 3,
                category: 'points',
                question: 'Do my points expire?',
                answer: `No, your Purple Rewards points never expire! However:
                <ul>
                    <li>Points are deducted when you redeem rewards from Holly Store</li>
                    <li>Points are used for Lucky Pick betting packages</li>
                    <li>Your tier level is based on your current point balance</li>
                    <li>Double points bonuses are temporary (15-20 minutes)</li>
                </ul>
                <strong>Keep earning to maintain and advance your tier status!</strong>`
            },
            {
                id: 4,
                category: 'points',
                question: 'What is the double points bonus?',
                answer: `Double points is a temporary boost that doubles all points you earn:
                <ul>
                    <li><strong>Duration:</strong> 15-20 minutes depending on activity</li>
                    <li><strong>Activation:</strong> Automatically triggered after tournament participation</li>
                    <li><strong>Applies to:</strong> All point-earning activities during the active period</li>
                    <li><strong>Status:</strong> Check your profile to see if double points is active</li>
                </ul>
                <strong>Make the most of this bonus by earning points while it's active!</strong>`
            },
            
            // Rewards
            {
                id: 5,
                category: 'rewards',
                question: 'How does the daily spin wheel work?',
                answer: `The daily spin wheel is your free chance to win rewards:
                <ul>
                    <li><strong>Frequency:</strong> Once per day</li>
                    <li><strong>Prizes:</strong> 25-500 points, free spins, cashback, bonus multipliers</li>
                    <li><strong>Special Prize:</strong> Jackpot can award up to 500 points</li>
                    <li><strong>Access:</strong> Click "Daily Free Spin" in the rewards section</li>
                </ul>
                <strong>Don't miss your daily spin - it's completely free!</strong>`
            },
            {
                id: 6,
                category: 'rewards',
                question: 'What are prize drops and how do I win them?',
                answer: `Prize drops are random physical prizes you can win:
                <ul>
                    <li><strong>Trigger:</strong> 5% chance when betting on selected slot games</li>
                    <li><strong>Prizes:</strong> Air fryers, laptops, headphones, coffee machines, and more</li>
                    <li><strong>Value:</strong> Prizes range from R400 to R8,000</li>
                    <li><strong>Rarity:</strong> Common to legendary prizes with different drop rates</li>
                    <li><strong>Delivery:</strong> Physical prizes delivered within 5-7 business days</li>
                </ul>
                <strong>Keep playing selected games for your chance to win!</strong>`
            },
            {
                id: 7,
                category: 'rewards',
                question: 'When can I claim my birthday bonus?',
                answer: `Your birthday bonus is available during your birthday week:
                <ul>
                    <li><strong>Timing:</strong> 7 days before and 7 days after your birthday</li>
                    <li><strong>Amount:</strong> Tier-based (100-500 points)</li>
                    <li><strong>Frequency:</strong> Once per year</li>
                    <li><strong>Location:</strong> Check your profile for availability and countdown</li>
                </ul>
                <strong>The bonus amount increases with your tier level!</strong>`
            },
            
            // Tournaments
            {
                id: 8,
                category: 'tournaments',
                question: 'What tournaments are available?',
                answer: `Purple Rewards offers several tournament types:
                <ul>
                    <li><strong>🏇 Horse Racing:</strong> Bet on horses with realistic odds and win multipliers</li>
                    <li><strong>🎰 Slots Tournament:</strong> Race to 10,000 points on selected slot machines</li>
                    <li><strong>🍀 Lucky Pick:</strong> Algorithm-generated betting packages for beginners</li>
                </ul>
                <strong>All tournaments redirect to external betting platforms and activate double points!</strong>`
            },
            {
                id: 9,
                category: 'tournaments',
                question: 'How does Lucky Pick work?',
                answer: `Lucky Pick is perfect for novice bettors:
                <ul>
                    <li><strong>Algorithm Selection:</strong> Smart system picks the best bets for you</li>
                    <li><strong>Package Options:</strong> Starter (R50), Value (R100), Premium (R200)</li>
                    <li><strong>Confidence Ratings:</strong> Each bet shows algorithm confidence percentage</li>
                    <li><strong>No Knowledge Required:</strong> Perfect for beginners who don't understand betting</li>
                    <li><strong>Bonus:</strong> 20 minutes of double points after activation</li>
                </ul>
                <strong>Just select a package and let the algorithm do the work!</strong>`
            },
            
            // Holly Store
            {
                id: 10,
                category: 'store',
                question: 'How does the Holly Store work?',
                answer: `Holly Store lets you redeem points for real discounts:
                <ul>
                    <li><strong>Categories:</strong> Travel, Dining, Shopping, Entertainment</li>
                    <li><strong>Partners:</strong> FlySafair, Uber Eats, Takealot, Woolworths, and more</li>
                    <li><strong>Tier-Based:</strong> Better discounts unlock as you advance tiers</li>
                    <li><strong>Instant Redemption:</strong> Get discount codes immediately</li>
                    <li><strong>Real Savings:</strong> 5-25% off with major South African brands</li>
                </ul>
                <strong>Higher tiers get better discounts and exclusive partners!</strong>`
            },
            {
                id: 11,
                category: 'store',
                question: 'What FlySafair discounts are available?',
                answer: `FlySafair discounts vary by tier:
                <ul>
                    <li><strong>Rookie:</strong> 5% off domestic flights (500 points)</li>
                    <li><strong>Power Player:</strong> 10% off domestic flights (800 points)</li>
                    <li><strong>Spin Master:</strong> 15% off + priority boarding (1,200 points)</li>
                    <li><strong>High Roller:</strong> 20% off + airport lounge access (2,000 points)</li>
                </ul>
                <strong>Advance your tier for better flight discounts and perks!</strong>`
            },
            
            // Account
            {
                id: 12,
                category: 'account',
                question: 'How do I create an account?',
                answer: `Creating an account is easy:
                <ul>
                    <li><strong>Sign Up:</strong> Click "Sign Up" and fill in your details</li>
                    <li><strong>Social Login:</strong> Use Google, Facebook, or Apple for quick access</li>
                    <li><strong>Demo Mode:</strong> Try the system with any email/password combination</li>
                    <li><strong>Starter Points:</strong> New accounts get 150 points to begin</li>
                    <li><strong>Instant Access:</strong> Start earning and redeeming immediately</li>
                </ul>
                <strong>Your account saves all progress and points automatically!</strong>`
            },
            {
                id: 13,
                category: 'account',
                question: 'Is my data safe and secure?',
                answer: `We take your privacy and security seriously:
                <ul>
                    <li><strong>Local Storage:</strong> Demo data stored locally on your device</li>
                    <li><strong>No Personal Data:</strong> We don't collect sensitive personal information</li>
                    <li><strong>Secure Connections:</strong> All external links use secure protocols</li>
                    <li><strong>Demo Environment:</strong> This is a demonstration loyalty program</li>
                    <li><strong>No Real Transactions:</strong> Points and rewards are for demo purposes</li>
                </ul>
                <strong>This is a demo system designed to showcase loyalty program features.</strong>`
            }
        ];

        let currentFAQFilter = 'all';
        let faqSearchTerm = '';

        function initializeFAQ() {
            populateFAQList();
            setupFAQSearch();
        }

        function populateFAQList() {
            const container = document.getElementById('faqList');
            const filteredFAQs = filterFAQData();
            
            if (filteredFAQs.length === 0) {
                container.innerHTML = '';
                document.getElementById('faqNoResults').style.display = 'block';
                return;
            }

            document.getElementById('faqNoResults').style.display = 'none';
            
            container.innerHTML = filteredFAQs.map(faq => `
                <div class="faq-item" data-category="${faq.category}">
                    <div class="faq-question" onclick="toggleFAQ(${faq.id})">
                        <div class="faq-question-text">${highlightSearchTerm(faq.question)}</div>
                        <div class="faq-toggle">▼</div>
                    </div>
                    <div class="faq-answer">
                        <div class="faq-answer-content">${highlightSearchTerm(faq.answer)}</div>
                    </div>
                </div>
            `).join('');
        }

        function filterFAQData() {
            let filtered = faqData;
            
            // Filter by category
            if (currentFAQFilter !== 'all') {
                filtered = filtered.filter(faq => faq.category === currentFAQFilter);
            }
            
            // Filter by search term
            if (faqSearchTerm) {
                filtered = filtered.filter(faq => 
                    faq.question.toLowerCase().includes(faqSearchTerm.toLowerCase()) ||
                    faq.answer.toLowerCase().includes(faqSearchTerm.toLowerCase())
                );
            }
            
            return filtered;
        }

        function highlightSearchTerm(text) {
            if (!faqSearchTerm) return text;
            
            const regex = new RegExp(`(${faqSearchTerm})`, 'gi');
            return text.replace(regex, '<span class="faq-highlight">$1</span>');
        }

        function filterFAQ(category) {
            currentFAQFilter = category;
            
            // Update active button
            document.querySelectorAll('.faq-category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Refresh FAQ list
            populateFAQList();
        }

        function setupFAQSearch() {
            const searchInput = document.getElementById('faqSearchInput');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    faqSearchTerm = e.target.value.trim();
                    populateFAQList();
                });
            }
        }

        function toggleFAQ(faqId) {
            const faqItems = document.querySelectorAll('.faq-item');
            const targetItem = Array.from(faqItems).find(item => 
                item.querySelector('.faq-question').getAttribute('onclick').includes(faqId)
            );
            
            if (targetItem) {
                const isActive = targetItem.classList.contains('active');
                
                // Close all other FAQ items
                faqItems.forEach(item => item.classList.remove('active'));
                
                // Toggle the clicked item
                if (!isActive) {
                    targetItem.classList.add('active');
                }
            }
        }

        function contactSupport() {
            showNotification('📧 Support contact form would open here. This is a demo system.');
        }

        function toggleFAQSection() {
            const faqSection = document.getElementById('faqSection');
            faqSection.classList.toggle('collapsed');
            
            // Update challenge progress for FAQ exploration
            if (!faqSection.classList.contains('collapsed')) {
                updateChallengeProgress('faq');
            }
        }

        function openHollyStore() {
            // Update challenge progress for store visit
            updateChallengeProgress('store');
            
            const modal = document.getElementById('modal');
            const modalContent = modal.querySelector('.modal-content');
            
            // Add Holly Store modal class
            modalContent.className = 'modal-content holly-store-modal';
            
            modalContent.innerHTML = `
                <div class="holly-store-modal-header">
                    <h2 class="holly-store-modal-title">
                        🛍️ Holly Store
                    </h2>
                    <button class="holly-store-close-btn" onclick="closeModal()">
                        ✕
                    </button>
                </div>
                
                <div class="holly-store-modal-body">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <p style="color: #666; margin-bottom: 20px;">Redeem your points for exclusive rewards and discounts</p>
                        <div style="background: rgba(118, 75, 162, 0.1); padding: 15px; border-radius: 15px; display: inline-block;">
                            <strong>Your Points: </strong><span style="color: #764ba2; font-size: 18px;">${userData.points}</span>
                        </div>
                    </div>

                    <div id="hollyStoreCategories" style="display: grid; gap: 20px;">
                        <!-- Store categories will be populated here -->
                    </div>

                    <div style="text-align: center; margin-top: 30px; padding: 20px; background: rgba(118, 75, 162, 0.05); border-radius: 15px;">
                        <p style="color: #666; margin-bottom: 15px;">
                            <strong>Tier Benefits:</strong> Higher tiers unlock better discounts and exclusive partners!
                        </p>
                        <div style="font-size: 14px; color: #999;">
                            Current Tier: <strong style="color: #764ba2;">${tiers[userData.currentTier].icon} ${tiers[userData.currentTier].name}</strong>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
            
            // Populate the Holly Store in the modal
            setTimeout(() => {
                populateHollyStoreModal();
            }, 100);
        }

        function populateHollyStoreModal() {
            const container = document.getElementById('hollyStoreCategories');
            if (!container) return;
            
            container.innerHTML = '';

            Object.keys(hollyStoreItems).forEach(categoryKey => {
                const category = hollyStoreItems[categoryKey];
                const categoryDiv = document.createElement('div');
                categoryDiv.style.cssText = `
                    background: white;
                    border-radius: 15px;
                    padding: 20px;
                    border: 2px solid #f0f0f0;
                    transition: all 0.3s ease;
                `;

                categoryDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                        <div style="font-size: 32px; width: 50px; height: 50px; background: rgba(118, 75, 162, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            ${category.icon}
                        </div>
                        <div>
                            <h3 style="margin: 0; color: #333;">${category.name}</h3>
                            <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">${category.description}</p>
                        </div>
                    </div>
                    <div style="display: grid; gap: 12px;">
                        ${category.items.map(item => createHollyStoreItemHTML(item)).join('')}
                    </div>
                `;

                container.appendChild(categoryDiv);
            });
        }

        function createHollyStoreItemHTML(item) {
            const canRedeem = userData.currentTier >= item.minTier && userData.points >= item.points;
            const tierLocked = userData.currentTier < item.minTier;
            const pointsInsufficient = userData.currentTier >= item.minTier && userData.points < item.points;

            let itemStyle = `
                background: rgba(118, 75, 162, 0.05);
                border-radius: 10px;
                padding: 15px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                transition: all 0.3s ease;
                border: 1px solid rgba(118, 75, 162, 0.1);
            `;

            if (tierLocked) {
                itemStyle += `opacity: 0.6; position: relative;`;
            } else if (pointsInsufficient) {
                itemStyle += `opacity: 0.7;`;
            }

            let buttonText = 'Redeem';
            let buttonDisabled = false;
            let buttonStyle = `
                background: linear-gradient(135deg, #ffd700, #ffb300);
                color: #333;
                border: none;
                border-radius: 15px;
                padding: 8px 16px;
                font-size: 12px;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
            `;

            if (tierLocked) {
                buttonText = `Tier ${item.minTier}+`;
                buttonDisabled = true;
                buttonStyle += `opacity: 0.5; cursor: not-allowed;`;
            } else if (pointsInsufficient) {
                buttonText = 'Not Enough';
                buttonDisabled = true;
                buttonStyle += `opacity: 0.5; cursor: not-allowed;`;
            }

            return `
                <div style="${itemStyle}">
                    ${tierLocked ? '<div style="position: absolute; top: 10px; right: 10px; font-size: 16px;">🔒</div>' : ''}
                    <div style="flex: 1;">
                        <div style="font-weight: bold; font-size: 15px; margin-bottom: 5px;">${item.name}</div>
                        <div style="font-size: 13px; color: #666; margin-bottom: 8px;">${item.description}</div>
                        <div style="font-size: 11px; background: rgba(118, 75, 162, 0.2); padding: 3px 8px; border-radius: 10px; display: inline-block;">
                            ${tiers[item.minTier].icon} ${tiers[item.minTier].name}+ Required
                        </div>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <div style="font-size: 16px; font-weight: bold; color: #ffd700;">${item.points} pts</div>
                        <button onclick="redeemStoreItem('${item.id}')" 
                                style="${buttonStyle}" 
                                ${buttonDisabled ? 'disabled' : ''}>
                            ${buttonText}
                        </button>
                    </div>
                </div>
            `;
        }

        // Initialize FAQ and Holly Store when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Existing event listeners...
            const betInput = document.getElementById('betInput');
            if (betInput) {
                betInput.addEventListener('input', updatePotentialWin);
            }
            
            const spinInput = document.getElementById('spinInput');
            if (spinInput) {
                spinInput.addEventListener('input', updateSpinButton);
            }

            // Initialize systems
            setTimeout(() => {
                if (authState.isAuthenticated) {
                    initializeFAQ();
                    initializeChallenges();
                    // Update Holly Store points display
                    const hollyStorePointsElement = document.getElementById('hollyStorePoints');
                    if (hollyStorePointsElement) {
                        hollyStorePointsElement.textContent = userData.points;
                    }
                }
            }, 1000);
        });

        // Lucky Pick System
        let luckyPickState = {
            selectedPackage: null,
            currentPackages: []
        };

        const betGames = [
            { name: "Hot Hot Hollywoodbets", icon: "🔥", type: "slots" },
            { name: "Sweet Bonanza", icon: "🍭", type: "slots" },
            { name: "Sahara Riches", icon: "🏜️", type: "slots" },
            { name: "African Fortune", icon: "🦁", type: "slots" },
            { name: "Chilli Heat", icon: "🌶️", type: "slots" },
            { name: "Thunder Bolt", icon: "⚡", type: "horse" },
            { name: "Midnight Star", icon: "🌟", type: "horse" },
            { name: "Golden Arrow", icon: "🏹", type: "horse" },
            { name: "Storm Chaser", icon: "🌪️", type: "horse" }
        ];

        const betTypes = [
            { name: "Win", multiplier: 2.5, confidence: 75 },
            { name: "Place", multiplier: 1.8, confidence: 85 },
            { name: "Each Way", multiplier: 3.2, confidence: 65 },
            { name: "Exacta", multiplier: 8.5, confidence: 45 },
            { name: "Trifecta", multiplier: 15.0, confidence: 25 },
            { name: "Bonus Round", multiplier: 4.2, confidence: 60 },
            { name: "Free Spins", multiplier: 3.8, confidence: 70 }
        ];

        function showLuckyPick() {
            closeModal();
            generateBetPackages();
            document.getElementById('luckyPickOverlay').classList.add('active');
        }

        function closeLuckyPick() {
            document.getElementById('luckyPickOverlay').classList.remove('active');
            luckyPickState.selectedPackage = null;
            luckyPickState.currentPackages = [];
        }

        function generateBetPackages() {
            const packages = [
                generatePackage("Starter Pack", 50, 3, "Perfect for first-time bettors"),
                generatePackage("Value Pack", 100, 5, "Great balance of risk and reward"),
                generatePackage("Premium Pack", 200, 8, "Maximum winning potential")
            ];
            
            luckyPickState.currentPackages = packages;
            displayBetPackages(packages);
        }

        function generatePackage(name, basePrice, numBets, description) {
            const bets = [];
            const usedGames = new Set();
            
            for (let i = 0; i < numBets; i++) {
                let game, betType, amount;
                
                // Ensure we don't repeat games
                do {
                    game = betGames[Math.floor(Math.random() * betGames.length)];
                } while (usedGames.has(game.name) && usedGames.size < betGames.length);
                
                usedGames.add(game.name);
                
                // Select appropriate bet type based on game type
                if (game.type === "slots") {
                    betType = betTypes.filter(bt => ["Win", "Bonus Round", "Free Spins"].includes(bt.name))[Math.floor(Math.random() * 3)];
                } else {
                    betType = betTypes.filter(bt => ["Win", "Place", "Each Way", "Exacta"].includes(bt.name))[Math.floor(Math.random() * 4)];
                }
                
                // Calculate bet amount based on package tier
                const baseAmount = Math.floor(basePrice / numBets);
                amount = baseAmount + Math.floor(Math.random() * (baseAmount * 0.5));
                
                bets.push({
                    game: game,
                    betType: betType,
                    amount: amount,
                    potentialWin: Math.floor(amount * betType.multiplier)
                });
            }
            
            const totalAmount = bets.reduce((sum, bet) => sum + bet.amount, 0);
            const totalPotential = bets.reduce((sum, bet) => sum + bet.potentialWin, 0);
            const avgConfidence = Math.floor(bets.reduce((sum, bet) => sum + bet.betType.confidence, 0) / bets.length);
            
            return {
                name: name,
                description: description,
                price: totalAmount,
                bets: bets,
                totalPotential: totalPotential,
                confidence: avgConfidence,
                numBets: numBets
            };
        }

        function displayBetPackages(packages) {
            const container = document.getElementById('betPackages');
            container.innerHTML = '';
            
            packages.forEach((pkg, index) => {
                const packageDiv = document.createElement('div');
                packageDiv.className = 'bet-package';
                packageDiv.onclick = () => selectPackage(index);
                
                packageDiv.innerHTML = `
                    <div class="package-header">
                        <div class="package-name">${pkg.name}</div>
                        <div class="package-price">R${pkg.price}</div>
                    </div>
                    <div class="package-description">${pkg.description}</div>
                    
                    <div class="confidence-indicator">
                        <span style="font-size: 12px; color: #666;">Algorithm Confidence:</span>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${pkg.confidence}%"></div>
                        </div>
                        <div class="confidence-text">${pkg.confidence}%</div>
                    </div>
                    
                    <div class="package-bets">
                        <div class="package-bets-title">📋 Selected Bets (${pkg.numBets})</div>
                        <div class="bet-list">
                            ${pkg.bets.map(bet => `
                                <div class="bet-item">
                                    <div>
                                        <div class="bet-game">${bet.game.icon} ${bet.game.name}</div>
                                        <div class="bet-details">${bet.betType.name} • ${bet.betType.confidence}% confidence</div>
                                    </div>
                                    <div class="bet-amount">R${bet.amount}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="package-stats">
                        <div class="stat-item">
                            <div class="stat-value">${pkg.numBets}</div>
                            <div class="stat-label">Bets</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">R${pkg.totalPotential}</div>
                            <div class="stat-label">Max Win</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${Math.floor((pkg.totalPotential / pkg.price) * 100)}%</div>
                            <div class="stat-label">ROI</div>
                        </div>
                    </div>
                `;
                
                container.appendChild(packageDiv);
            });
        }

        function selectPackage(index) {
            luckyPickState.selectedPackage = index;
            
            // Update visual selection
            document.querySelectorAll('.bet-package').forEach((pkg, i) => {
                pkg.classList.toggle('selected', i === index);
            });
            
            // Enable activate button
            const activateBtn = document.getElementById('activateBetsBtn');
            activateBtn.disabled = false;
            activateBtn.textContent = `🚀 Activate Bets (R${luckyPickState.currentPackages[index].price})`;
        }

        function regenerateBets() {
            generateBetPackages();
            luckyPickState.selectedPackage = null;
            document.getElementById('activateBetsBtn').disabled = true;
            document.getElementById('activateBetsBtn').textContent = '🚀 Activate Bets';
            showNotification('🔄 New bet combinations generated!');
        }

        function activateLuckyPick() {
            if (luckyPickState.selectedPackage === null) return;
            
            const selectedPkg = luckyPickState.currentPackages[luckyPickState.selectedPackage];
            
            // Check if user has enough points
            if (selectedPkg.price > userData.points) {
                showNotification(`Not enough points! You need ${selectedPkg.price} points but only have ${userData.points}.`);
                return;
            }
            
            // Deduct points
            userData.points -= selectedPkg.price;
            document.getElementById('pointsDisplay').textContent = `${userData.points} Points`;
            
            // Save points if user is logged in
            if (authState.currentUser) {
                authState.currentUser.points = userData.points;
                localStorage.setItem('purpleRewardsUser', JSON.stringify(authState.currentUser));
            }
            
            // Show success message
            showNotification(`🍀 Lucky Pick activated! ${selectedPkg.numBets} bets placed for R${selectedPkg.price}. Good luck!`);
            
            // Activate double points bonus
            activateDoublePoints(20);
            
            // Check for prize drop
            setTimeout(() => {
                checkForPrizeDrop();
            }, 1500);
            
            // Close lucky pick
            closeLuckyPick();
            
            // Simulate external betting redirect
            setTimeout(() => {
                const url = 'https://example.com/external/lucky-pick-bets';
                window.open(url, '_blank', 'noopener');
            }, 500);
        }
    </script>
</body>
</html>